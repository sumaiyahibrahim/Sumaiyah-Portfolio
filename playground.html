<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Playground – Interactive Experiments</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="assets/favicon-sparkle.svg">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'poppins': ['Poppins', 'sans-serif'],
          },
          colors: {
            'cream': '#f8f8e1',
          }
        }
      }
    }
  </script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Playwrite+AU+SA:wght@100..400&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- AOS -->
  <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">

  <!-- Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <!-- Pyodide for Python execution -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>

  <!-- Chart.js for data visualization -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body { font-family: 'Poppins', sans-serif; }
    .font-playwrite { font-family: 'Playwrite AU SA', cursive; }

    /* Hero motion backdrop */
    .blob-bg { position: absolute; inset: -20%; filter: blur(40px); opacity: 0.7; pointer-events: none; }
    .blob-bg::before, .blob-bg::after { content: ""; position: absolute; width: 50vw; height: 50vw; border-radius: 50%; }
    .blob-bg::before { left: 10%; top: 0; background: radial-gradient(closest-side, rgba(236,72,153,0.25), transparent 65%); animation: float1 16s ease-in-out infinite; }
    .blob-bg::after { right: 10%; bottom: 0; background: radial-gradient(closest-side, rgba(139,92,246,0.22), transparent 65%); animation: float2 18s ease-in-out infinite; }
    @keyframes float1 { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-25px); } }
    @keyframes float2 { 0%,100% { transform: translateY(0); } 50% { transform: translateY(25px); } }
    @keyframes rotate { 0% { transform: rotateX(0deg) rotateY(0deg); } 100% { transform: rotateX(360deg) rotateY(360deg); } }

    /* Custom button style matching index.html */
    .custom-button {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      outline: none;
      user-select: none;
      color: #ffffff;
      border: 1px solid #000000;
      border-radius: 4px;
      background-color: #ec4899;
      box-shadow: 4px 4px 0px 0px #be185d;
      text-decoration: none;
      text-align: center;
    }
    .custom-button:hover {
      transition: all 0.3s ease;
      transform: translateY(-2px);
    }

    /* Prevent auto-scroll */
    html {
      scroll-behavior: auto;
    }
    
    body {
      scroll-behavior: auto;
    }
    
    /* Disable any automatic scrolling */
    * {
      scroll-behavior: auto !important;
    }
    
    /* Prevent AOS from causing scroll issues */
    [data-aos] {
      opacity: 1 !important;
      transform: none !important;
      transition: none !important;
    }
    
    /* Glassmorphism Navbar */
    .glassmorphism-navbar {
      background: #f8f8e1;
      backdrop-filter: none;
      -webkit-backdrop-filter: none;
      border: none;
      border-radius: 0;
      box-shadow: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .glassmorphism-navbar.scrolled {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(24px) saturate(150%);
      -webkit-backdrop-filter: blur(24px) saturate(150%);
      border: none;
      border-radius: 0;
      box-shadow: none;
    }
    
    
    /* Active link styling */
    .nav-link-active {
      color: #ff4da6 !important;
    }
    
    /* Nav link hover effects */
    .nav-link {
      transition: all 0.2s ease;
      position: relative;
    }
    
    .nav-link:hover {
      color: #ff4da6;
      transform: translateY(-1px);
    }
    
    /* Social icon effects */
    .social-icon {
      transition: all 0.2s ease;
      border-radius: 8px;
      padding: 8px;
    }
    
    .social-icon:hover {
      color: #ff4da6;
      background: rgba(255, 77, 166, 0.1);
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(255, 77, 166, 0.2);
    }
    
    /* Mobile menu glassmorphism */
    .mobile-menu-glass {
      background: rgba(255, 255, 255, 0.35);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    /* Logo hover effect */
    .logo-hover {
      transition: all 0.3s ease;
    }
    
    .logo-hover:hover {
      transform: rotate(5deg) scale(1.05);
    }
  </style>
</head>

<body class="antialiased">
    <!-- Navigation -->
    <header class="sticky top-0 z-50 glassmorphism-navbar">
        <nav class="mx-auto max-w-7xl p-3 md:p-4 grid grid-cols-[auto_1fr_auto] items-center gap-4">
            <!-- Left: Logo -->
            <a href="index.html" class="justify-self-start logo-hover">
                <img src="assets/logo-sparkle.svg" alt="Logo" class="h-10 w-10">
            </a>

            <!-- Center: Desktop Nav -->
            <div class="hidden lg:block justify-self-center">
                <ul class="flex items-center justify-center gap-8 text-gray-700">
                    <li><a href="index.html" class="nav-link text-gray-700 hover:text-pink-500 transition-colors">Home</a></li>
                    <li class="text-black">✦</li>
                    <li><a href="about.html" class="nav-link text-gray-700 hover:text-pink-500 transition-colors">About</a></li>
                    <li class="text-black">✦</li>
                    <li><a href="project.html" class="nav-link text-gray-700 hover:text-pink-500 transition-colors">Projects</a></li>
                    <li class="text-black">✦</li>
                    <li><a href="playground.html" class="nav-link nav-link-active text-gray-700 hover:text-pink-500 transition-colors">Playground</a></li>
                    <li class="text-black">✦</li>
                    <li><a href="connect.html" class="nav-link text-gray-700 hover:text-pink-500 transition-colors">Connect</a></li>
                </ul>
            </div>

            <!-- Right: Socials -->
            <div class="hidden lg:flex items-center justify-self-end space-x-6 text-gray-700 text-xl">
                <a href="https://github.com/sumaiyahibrahim" target="_blank" rel="noopener noreferrer" class="social-icon hover:text-pink-500 transition-colors"><i class="fab fa-github"></i></a>
                <a href="https://www.linkedin.com/in/sumaiyah-ibrahim-27049a284" target="_blank" rel="noopener noreferrer" class="social-icon hover:text-pink-500 transition-colors"><i class="fab fa-linkedin"></i></a>
                <a href="mailto:sumaiyahibrahim15@gmail.com" class="social-icon hover:text-pink-500 transition-colors"><i class="fas fa-envelope"></i></a>
            </div>

            <!-- Mobile Nav Button -->
            <div id="hamburger" class="lg:hidden cursor-pointer justify-self-end">
                <div class="w-6 h-0.5 bg-gray-700 mb-1.5 transition-transform duration-300 hamburger-line-1"></div>
                <div class="w-6 h-0.5 bg-gray-700 transition-opacity duration-300 hamburger-line-2"></div>
                <div class="w-6 h-0.5 bg-gray-700 mt-1.5 transition-transform duration-300 hamburger-line-3"></div>
            </div>
        </nav>
    </header>
    
    <!-- Mobile Menu -->
    <div id="mobile-menu" class="fixed top-0 left-0 w-full h-full bg-[#f8f8e1]/95 backdrop-blur-sm flex flex-col justify-center items-center z-40 transition-transform duration-300 -translate-x-full">
        <ul class="text-2xl text-gray-700 text-center space-y-8">
            <li><a href="index.html" class="hover:text-pink-500">Home</a></li>
            <li><a href="about.html" class="hover:text-pink-500">About</a></li>
            <li><a href="project.html" class="hover:text-pink-500">Projects</a></li>
            <li><a href="playground.html" class="hover:text-pink-500">Playground</a></li>
            <li><a href="connect.html" class="hover:text-pink-500">Connect</a></li>
        </ul>
        <div class="flex items-center space-x-8 text-gray-700 text-3xl absolute bottom-20">
            <a href="https://github.com/sumaiyahibrahim" target="_blank" rel="noopener noreferrer" class="hover:text-pink-500 transition-colors"><i class="fab fa-github"></i></a>
            <a href="https://www.linkedin.com/in/sumaiyah-ibrahim-27049a284" target="_blank" rel="noopener noreferrer" class="hover:text-pink-500 transition-colors"><i class="fab fa-linkedin"></i></a>
            <a href="mailto:sumaiyahibrahim15@gmail.com" class="hover:text-pink-500 transition-colors"><i class="fas fa-envelope"></i></a>
        </div>
    </div>

  <!-- Hero Section -->
  <section class="relative min-h-screen flex items-center overflow-hidden bg-cream pt-6">
    <div class="blob-bg"></div>
    
    <div class="mx-auto max-w-7xl px-4 py-14 grid md:grid-cols-2 gap-8 items-center">
      <div data-aos="fade-right">
        <h1 class="text-3xl md:text-4xl font-semibold text-[#2c2c2c]">Explore my interactive projects</h1>
        <p class="text-gray-600 mt-3">A playful mix of AI experiments, web micro-interactions, and creative demos. Click, drag, hover — break things and have fun.</p>
        <div class="mt-8 flex justify-center md:justify-start">
          <button onclick="scrollToGallery()" class="custom-button">
            <i class="fa-solid fa-rocket mr-2"></i>Start Exploring
          </button>
        </div>
      </div>
      <div class="relative flex justify-center md:justify-end" data-aos="fade-left">
        <div class="relative">
          <img src="assets/avatar sitting.png" alt="Sitting avatar" class="w-72 md:w-96 drop-shadow-[0_25px_40px_rgba(236,72,153,0.25)] object-contain" loading="lazy">
        </div>
      </div>
    </div>
  </section>

  <!-- Demo Gallery Section -->
  <section class="py-16 bg-cream" id="gallery">
    <div class="mx-auto max-w-7xl px-4">
      <div class="text-center mb-12" data-aos="fade-up">
        <h2 class="text-3xl font-bold text-gray-800 mb-4">Interactive Demos</h2>
        <p class="text-gray-600">Try out these interactive projects and experiments</p>
      </div>
      
      <!-- Responsive Grid: 1 on mobile, 2 on tablet, 3 on desktop/large screens -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        
        <!-- Chatbot Card -->
        <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden flex flex-col h-full" data-aos="fade-up">
          <!-- Header -->
          <div class="flex items-center justify-between p-4 border-b border-gray-100">
            <h3 class="text-xl font-bold text-gray-800">Chatbot Playground</h3>
            <div class="flex items-center gap-2">
              <button id="infoBtn" class="w-8 h-8 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 flex items-center justify-center transition-colors" title="Info">
                <i class="fa-solid fa-info text-sm"></i>
              </button>
              <button id="settingsBtn" class="w-8 h-8 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 flex items-center justify-center transition-colors" title="Settings">
                <i class="fa-solid fa-gear text-sm"></i>
              </button>
            </div>
          </div>

          <!-- Chat Area -->
          <div class="h-80 bg-gray-50 flex flex-col flex-1">
            <!-- Messages -->
            <div id="chatMessages" class="flex-1 p-4 overflow-y-auto space-y-3">
              <div class="flex items-start gap-2">
                <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm flex-shrink-0">
                  <i class="fa-solid fa-robot"></i>
                </div>
                <div class="bg-white rounded-lg px-3 py-2 shadow-sm max-w-xs">
                  <p class="text-sm text-gray-700">Hi! I'm your AI assistant. Click the ⚙️ settings to add your API key and start chatting!</p>
                </div>
              </div>
            </div>

            <!-- Typing Indicator -->
            <div id="typingIndicator" class="hidden px-4 pb-2">
              <div class="flex items-start gap-2">
                <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm flex-shrink-0">
                  <i class="fa-solid fa-robot"></i>
                </div>
                <div class="bg-white rounded-lg px-3 py-2 shadow-sm">
                  <div class="flex space-x-1">
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Input Area -->
            <div class="border-t border-gray-200 p-4">
              <div class="flex gap-2">
                <input 
                  id="messageInput" 
                  type="text" 
                  placeholder="Type your message..." 
                  class="flex-1 px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                  disabled
                />
                <button 
                  id="sendBtn" 
                  class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                  disabled
                >
                  <i class="fa-solid fa-paper-plane text-sm"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Tech Tags -->
          <div class="px-4 pb-4 border-t border-gray-100 mt-auto flex-shrink-0">
            <div class="flex flex-wrap gap-2 pt-3">
              <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium">JavaScript</span>
              <span class="px-3 py-1 bg-pink-100 text-pink-800 rounded-full text-xs font-medium">OpenRouter</span>
              <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">AI</span>
            </div>
          </div>
        </div>

        <!-- Color Palette Generator Card -->
        <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden flex flex-col h-full" data-aos="fade-up" data-aos-delay="100">
          <!-- Header -->
          <div class="flex items-center justify-between p-4 border-b border-gray-100">
            <h3 class="text-lg font-bold text-gray-800">Color Palette Generator</h3>
            <div class="flex items-center gap-2">
              <button id="paletteInfoBtn" class="w-8 h-8 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 flex items-center justify-center transition-colors" title="Info">
                <i class="fa-solid fa-info text-sm"></i>
              </button>
            </div>
          </div>

          <!-- Main Demo Area -->
          <div class="p-4 pb-3 flex-1">
            <!-- Color Swatches -->
            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 mb-4" id="colorSwatches">
              <!-- Swatches will be generated by JavaScript -->
            </div>

            <!-- Controls -->
            <div class="space-y-3">
              <div class="flex gap-2 justify-center">
                <select id="paletteMode" class="flex-1 max-w-xs px-3 py-2 border border-gray-200 rounded-lg bg-white text-sm focus:outline-none focus:ring-2 focus:ring-pink-500">
                  <option value="pink-aesthetic">Pink Aesthetic</option>
                  <option value="pastels">Soft Pastels</option>
                  <option value="earth-tones">Earth & Browns</option>
                  <option value="ocean-vibes">Ocean Vibes</option>
                  <option value="sunset-warm">Sunset Warm</option>
                  <option value="forest-green">Forest Green</option>
                  <option value="lavender-dream">Lavender Dream</option>
                  <option value="vintage-cream">Vintage Cream</option>
                  <option value="neon-bright">Neon Bright</option>
                  <option value="autumn-spice">Autumn Spice</option>
                  <option value="midnight-dark">Midnight Dark</option>
                  <option value="coral-reef">Coral Reef</option>
                  <option value="sage-mint">Sage & Mint</option>
                  <option value="berry-wine">Berry Wine</option>
                  <option value="golden-hour">Golden Hour</option>
                  <option value="arctic-cool">Arctic Cool</option>
                  <option value="monochrome">Monochrome</option>
                  <option value="random">Random</option>
                </select>
                <button id="generatePaletteBtn" class="px-4 py-2 bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-lg text-sm font-medium hover:from-pink-600 hover:to-purple-600 transition-all shadow-md">
                  Generate
                </button>
              </div>
              <div class="flex justify-center mb-2">
                <button id="copyAllBtn" class="px-4 py-2 border border-pink-300 text-pink-600 rounded-lg text-sm font-medium hover:bg-pink-50 transition-colors">
                  Copy All Hex Codes
                </button>
              </div>
              
              <!-- Additional spacing to fill card -->
              <div class="text-center text-xs text-gray-500 py-2">
                Click swatches to copy • Lock colors to preserve • 16+ aesthetic themes
              </div>
            </div>
          </div>

          <!-- Footer -->
          <div class="px-4 pb-4 border-t border-gray-100 mt-auto flex-shrink-0">
            <div class="flex flex-wrap gap-2 pt-3 justify-center">
              <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium">JavaScript</span>
              <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">CSS</span>
              <span class="px-2 py-1 bg-pink-100 text-pink-800 rounded-full text-xs font-medium">Design</span>
            </div>
          </div>
        </div>

        <!-- 3D Cube Viewer Card -->
        <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden flex flex-col h-full" data-aos="fade-up" data-aos-delay="200">
          <!-- Header -->
          <div class="flex items-center justify-between p-4 border-b border-gray-100">
            <h3 class="text-lg font-bold text-gray-800">3D Cube Viewer</h3>
            <div class="flex items-center gap-2">
              <button id="cubeInfoBtn" class="w-8 h-8 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 flex items-center justify-center transition-colors" title="Info">
                <i class="fa-solid fa-info text-sm"></i>
              </button>
            </div>
          </div>

          <!-- Main Demo Area -->
          <div class="p-4 pb-3 flex-1">
            <!-- 3D Cube Container -->
            <div class="h-52 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl mb-4 relative overflow-hidden" id="cubeContainer">
              <!-- Three.js canvas will be inserted here -->
            </div>

            <!-- Controls -->
            <div class="space-y-3">
              <!-- Zoom Slider -->
              <div class="flex items-center gap-3 justify-center">
                <span class="text-xs text-gray-600 w-10">Zoom</span>
                <input id="zoomSlider" type="range" min="0.5" max="3" step="0.1" value="1" class="flex-1 max-w-36 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                <span class="text-xs text-gray-600 w-8">3x</span>
              </div>
              
              <!-- Preset Views & Reset -->
              <div class="flex gap-2 justify-center mb-2">
                <button id="frontView" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full text-xs font-medium transition-colors">
                  Front
                </button>
                <button id="topView" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full text-xs font-medium transition-colors">
                  Top
                </button>
                <button id="sideView" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full text-xs font-medium transition-colors">
                  Side
                </button>
                <button id="resetCube" class="px-3 py-1 bg-pink-500 hover:bg-pink-600 text-white rounded-full text-xs font-medium transition-colors">
                  Reset
                </button>
              </div>
              
              <!-- Additional info to fill space -->
              <div class="text-center text-xs text-gray-500 py-2">
                Drag to rotate • Zoom with slider • WebGL powered 3D rendering
              </div>
            </div>
          </div>

          <!-- Footer -->
          <div class="px-4 pb-4 border-t border-gray-100 mt-auto flex-shrink-0">
            <div class="flex flex-wrap gap-2 pt-3 justify-center">
              <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium">JavaScript</span>
              <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">Three.js</span>
              <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-medium">3D</span>
              <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">Interactive</span>
            </div>
          </div>
        </div>

        <!-- Weather Widget Card -->
        <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden flex flex-col h-full" data-aos="fade-up" data-aos-delay="300">
          <!-- Header -->
          <div class="flex items-center justify-between p-4 border-b border-gray-100">
            <h3 class="text-lg font-bold text-gray-800">Weather Widget</h3>
            <div class="flex items-center gap-2">
              <button id="weatherInfoBtn" class="w-8 h-8 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 flex items-center justify-center transition-colors" title="Info">
                <i class="fa-solid fa-info text-sm"></i>
              </button>
              <button id="weatherSettingsBtn" class="w-8 h-8 rounded-lg bg-gray-50 hover:bg-gray-100 text-gray-600 flex items-center justify-center transition-colors" title="Settings">
                <i class="fa-solid fa-gear text-sm"></i>
              </button>
            </div>
          </div>

          <!-- Main Demo Area -->
          <div class="p-4 pb-3 flex-1">
            <!-- Search Bar -->
            <div class="flex gap-2 mb-4">
              <input id="cityInput" type="text" placeholder="Enter city name..." class="flex-1 px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
              <button id="searchWeather" class="px-3 sm:px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium">
                <span class="hidden sm:inline">Search</span>
                <i class="fa-solid fa-search sm:hidden"></i>
              </button>
            </div>

            <!-- Weather Display -->
            <div id="weatherDisplay" class="h-48 bg-gradient-to-br from-blue-400 to-blue-600 rounded-xl flex flex-col items-center justify-center text-white transition-all duration-500">
              <div id="weatherContent" class="text-center">
                <div class="text-6xl mb-2">🌤️</div>
                <div class="text-sm opacity-90 mb-2">Enter a city to check weather</div>
                <div class="text-xs opacity-75">Live weather data powered by API</div>
              </div>
              
              <!-- Loading Spinner -->
              <div id="weatherLoading" class="hidden">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-white mb-2"></div>
                <div class="text-sm opacity-90">Loading weather...</div>
              </div>
            </div>

            <!-- Additional info to fill space -->
            <div class="text-center text-xs text-gray-500 py-2 mt-2">
              Real-time weather data • Global city support • Dynamic backgrounds
            </div>
          </div>

          <!-- Footer -->
          <div class="px-4 pb-4 border-t border-gray-100 mt-auto flex-shrink-0">
            <div class="flex flex-wrap gap-2 pt-3 justify-center">
              <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium">JavaScript</span>
              <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">API</span>
              <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">Weather</span>
              <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-medium">Interactive</span>
            </div>
          </div>
        </div>

        <!-- Python Console Card -->
        <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden flex flex-col h-full" data-aos="fade-up" data-aos-delay="400">
          <!-- Header -->
          <div class="flex items-center justify-between p-4 border-b border-gray-100">
            <h3 class="text-lg font-bold text-gray-800">Python Console</h3>
            <div class="flex items-center gap-2">
              <button id="pythonInfoBtn" class="w-8 h-8 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 flex items-center justify-center transition-colors" title="Info">
                <i class="fa-solid fa-info text-sm"></i>
              </button>
            </div>
          </div>

          <!-- Main Demo Area -->
          <div class="p-4 pb-3 flex-1">
            <!-- Console Controls -->
            <div class="flex justify-between items-center mb-3">
              <div class="text-sm text-gray-600">Interactive Python Console</div>
              <button id="clearConsole" class="px-3 py-1 bg-red-100 hover:bg-red-200 text-red-700 rounded-full text-xs font-medium transition-colors">
                Clear
              </button>
            </div>

            <!-- Python Console -->
            <div id="pythonConsole" class="bg-gray-900 rounded-lg p-4 h-64 overflow-y-auto font-mono text-sm">
              <div id="consoleOutput" class="text-green-400 whitespace-pre-wrap"></div>
              <div class="flex items-center text-white">
                <span class="text-yellow-400 mr-2">&gt;&gt;&gt;</span>
                <input 
                  id="pythonInput" 
                  type="text" 
                  class="flex-1 bg-transparent border-none outline-none text-white font-mono text-sm"
                  placeholder="Type Python code here..."
                  autocomplete="off"
                  spellcheck="false"
                />
                <span id="cursor" class="w-2 h-4 bg-white ml-1 animate-pulse"></span>
              </div>
            </div>

            <!-- Loading indicator -->
            <div id="pythonLoading" class="hidden text-center py-2">
              <div class="inline-flex items-center text-sm text-gray-600">
                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500 mr-2"></div>
                Loading Python environment...
              </div>
            </div>

            <!-- Additional info to fill space -->
            <div class="text-center text-xs text-gray-500 py-2 mt-2">
              Real Python execution • Multi-line support • Full error handling
            </div>
          </div>

          <!-- Footer -->
          <div class="px-4 pb-4 border-t border-gray-100 mt-auto flex-shrink-0">
            <div class="flex flex-wrap gap-2 pt-3 justify-center">
              <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">Python</span>
              <span class="px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs font-medium">Console</span>
              <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">Interactive</span>
              <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-medium">Code</span>
            </div>
          </div>
        </div>

        <!-- Drawing Canvas Card -->
        <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden flex flex-col h-full" data-aos="fade-up" data-aos-delay="500">
          <!-- Header -->
          <div class="flex items-center justify-between p-4 border-b border-gray-100">
            <h3 class="text-lg font-bold text-gray-800">Drawing Canvas</h3>
            <div class="flex items-center gap-2">
              <button id="canvasInfoBtn" class="w-8 h-8 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 flex items-center justify-center transition-colors" title="Info">
                <i class="fa-solid fa-info text-sm"></i>
              </button>
            </div>
          </div>

          <!-- Main Demo Area -->
          <div class="p-4 pb-3 flex-1">
            <!-- Canvas Toolbar -->
            <div class="flex flex-wrap items-center justify-center gap-2 mb-4 p-3 bg-gray-50 rounded-lg">
              <!-- Color Picker -->
              <div class="flex items-center gap-2">
                <span class="text-xs text-gray-600">Color:</span>
                <input id="colorPicker" type="color" value="#000000" class="w-8 h-8 rounded border-0 cursor-pointer">
              </div>
              
              <!-- Tools -->
              <div class="flex gap-2">
                <button id="drawTool" class="px-3 py-1 bg-blue-500 text-white rounded text-xs font-medium hover:bg-blue-600 transition-colors">
                  Draw
                </button>
                <button id="eraserTool" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-xs font-medium transition-colors">
                  Erase
                </button>
              </div>
              
              <!-- Brush Size -->
              <div class="flex items-center gap-2">
                <span class="text-xs text-gray-600">Size:</span>
                <input id="brushSize" type="range" min="1" max="20" value="3" class="w-16 h-2 bg-gray-200 rounded appearance-none cursor-pointer">
                <span id="sizeDisplay" class="text-xs text-gray-600 w-6">3</span>
              </div>
              
              <!-- Actions removed from toolbar -->
            </div>

            <!-- Drawing Canvas -->
            <div class="bg-white border-2 border-gray-200 rounded-lg overflow-hidden shadow-inner">
              <canvas id="drawingCanvas" width="600" height="280" class="w-full h-60 cursor-crosshair block"></canvas>
            </div>

            <!-- Actions after canvas -->
            <div class="flex justify-center gap-3 mt-4">
              <button id="downloadCanvas" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                <i class="fa-solid fa-download"></i>
                Save as PNG
              </button>
              <button id="clearCanvas" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                <i class="fa-solid fa-trash"></i>
                Clear Canvas
              </button>
            </div>
          </div>

          <!-- Footer -->
          <div class="px-4 pb-4 border-t border-gray-100 mt-auto flex-shrink-0">
            <div class="flex flex-wrap gap-2 pt-3 justify-center">
              <span class="px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs font-medium">Canvas</span>
              <span class="px-2 py-1 bg-pink-100 text-pink-800 rounded-full text-xs font-medium">Creative</span>
              <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium">Fun</span>
            </div>
          </div>
        </div>

      </div>

      <!-- Data Visualization Playground Card - Full Width Row -->
      <div class="w-full mt-8">
        <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden" data-aos="fade-up" data-aos-delay="600">
          <!-- Header -->
          <div class="flex items-center justify-between p-4 border-b border-gray-100">
            <h3 class="text-lg font-bold text-gray-800">Data Visualization Playground</h3>
            <div class="flex items-center gap-2">
              <button id="vizInfoBtn" class="w-8 h-8 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 flex items-center justify-center transition-colors" title="Info">
                <i class="fa-solid fa-info text-sm"></i>
              </button>
            </div>
          </div>

          <!-- Main Demo Area -->
          <div class="p-4 sm:p-6">
            <!-- Responsive Layout: Stacked on mobile, side-by-side on larger screens -->
            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-12 gap-4 sm:gap-6">
              
              <!-- Data Source Section -->
              <div class="md:col-span-1 xl:col-span-3">
                <div class="bg-gray-50 rounded-lg p-4 h-full">
                  <h4 class="font-medium text-gray-800 mb-4 text-sm">Data Source</h4>
                  
                  <!-- Sample Dataset Selector -->
                  <div class="mb-4">
                    <label class="block text-xs text-gray-600 mb-2">Sample Datasets:</label>
                    <select id="sampleDataset" class="w-full px-3 py-2 border border-gray-200 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
                      <option value="sales">Sales 2024</option>
                      <option value="population">Population by Country</option>
                      <option value="traffic">Website Traffic</option>
                    </select>
                  </div>
                  
                  <!-- CSV Upload -->
                  <div class="mb-4">
                    <label class="block text-xs text-gray-600 mb-2">Or Upload CSV:</label>
                    <div id="csvDropZone" class="border-2 border-dashed border-gray-300 rounded p-4 text-center cursor-pointer hover:border-blue-400 transition-colors">
                      <input type="file" id="csvFileInput" accept=".csv" class="hidden">
                      <p class="text-xs text-gray-500">Drop CSV here or click to browse</p>
                    </div>
                  </div>
                  
                  <!-- Data Preview -->
                  <div>
                    <label class="block text-xs text-gray-600 mb-2">Data Preview:</label>
                    <div id="dataPreview" class="bg-white border border-gray-200 rounded p-3 max-h-40 overflow-auto text-xs">
                      <div class="text-gray-500 text-center py-4">Select a dataset to preview</div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Chart Configuration -->
              <div class="md:col-span-1 xl:col-span-3">
                <div class="bg-gray-50 rounded-lg p-4 h-full">
                  <h4 class="font-medium text-gray-800 mb-4 text-sm">Chart Settings</h4>
                  
                  <!-- Chart Type -->
                  <div class="mb-4">
                    <label class="block text-xs text-gray-600 mb-2">Chart Type:</label>
                    <select id="chartType" class="w-full px-3 py-2 border border-gray-200 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
                      <option value="bar">Bar Chart</option>
                      <option value="line">Line Chart</option>
                      <option value="pie">Pie Chart</option>
                      <option value="scatter">Scatter Plot</option>
                      <option value="area">Area Chart</option>
                    </select>
                  </div>
                  
                  <!-- Column Mapping -->
                  <div class="mb-4">
                    <label class="block text-xs text-gray-600 mb-2">X-Axis Column:</label>
                    <select id="xAxisColumn" class="w-full px-3 py-2 border border-gray-200 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
                      <option value="">Select column...</option>
                    </select>
                  </div>
                  
                  <div class="mb-4">
                    <label class="block text-xs text-gray-600 mb-2">Y-Axis Column:</label>
                    <select id="yAxisColumn" class="w-full px-3 py-2 border border-gray-200 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
                      <option value="">Select column...</option>
                    </select>
                  </div>
                  
                  <!-- Actions -->
                  <div class="flex flex-col gap-2 mt-4 sm:mt-6">
                    <button id="updateChart" class="w-full px-3 sm:px-4 py-2 bg-blue-500 text-white rounded text-xs sm:text-sm font-medium hover:bg-blue-600 transition-colors">
                      Update Chart
                    </button>
                    <div class="flex flex-col sm:flex-row gap-2">
                      <button id="resetViz" class="flex-1 px-2 sm:px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-xs sm:text-sm font-medium transition-colors">
                        Reset
                      </button>
                      <button id="downloadChart" class="flex-1 px-2 sm:px-3 py-2 bg-green-500 text-white rounded text-xs sm:text-sm font-medium hover:bg-green-600 transition-colors">
                        Save Chart
                      </button>
                      <button id="downloadData" class="flex-1 px-2 sm:px-3 py-2 bg-purple-500 text-white rounded text-xs sm:text-sm font-medium hover:bg-purple-600 transition-colors">
                        Save Data
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Chart Display -->
              <div class="md:col-span-2 xl:col-span-6">
                <div class="bg-white border border-gray-200 rounded-lg p-3 sm:p-4 h-64 sm:h-80 md:h-96">
                  <canvas id="dataChart" class="w-full h-full hidden"></canvas>
                  <div id="chartPlaceholder" class="flex items-center justify-center h-full text-gray-500 text-xs sm:text-sm text-center px-4">
                    <div class="text-center">
                      <i class="fa-solid fa-chart-bar text-3xl mb-3 text-gray-300"></i>
                      <p class="font-medium mb-1">Ready to Visualize!</p>
                      <p class="text-xs">Select a dataset and chart type to get started</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Info -->
            <div class="text-center text-xs text-gray-500 py-3 mt-4 border-t border-gray-100">
              Upload CSV or use sample data • Choose chart type • Map columns • Interactive charts with hover tooltips
            </div>
          </div>

          <!-- Footer -->
          <div class="px-4 sm:px-6 pb-4 border-t border-gray-100 mt-auto">
            <div class="flex flex-wrap gap-2 pt-3 justify-center">
              <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">Data Viz</span>
              <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">Charts</span>
              <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-medium">Analytics</span>
              <span class="px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs font-medium">Interactive</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Close the main grid container -->
    </div>
  </div>

  <!-- Typing Speed Test & API Tester Row -->
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 mt-8 sm:mt-12 lg:mt-16">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8 lg:gap-12 max-w-7xl mx-auto">

      <!-- Typing Speed Test Card -->
      <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden flex flex-col h-full" data-aos="fade-up" data-aos-delay="800">
        <!-- Header -->
        <div class="flex items-center justify-between p-4 border-b border-gray-100">
          <h3 class="text-lg font-bold text-gray-800">Typing Speed Test</h3>
          <div class="flex items-center gap-2">
            <button id="typingInfoBtn" class="w-8 h-8 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 flex items-center justify-center transition-colors" title="Info">
              <i class="fa-solid fa-info text-sm"></i>
            </button>
          </div>
        </div>

        <!-- Main Demo Area -->
        <div class="p-6 flex-1">
          <!-- Test Controls -->
          <div class="mb-4">
            <div class="flex flex-wrap gap-2 mb-3">
              <select id="testDuration" class="px-3 py-1 border border-gray-200 rounded text-xs focus:outline-none focus:ring-1 focus:ring-blue-500">
                <option value="30">30 seconds</option>
                <option value="60" selected>1 minute</option>
                <option value="120">2 minutes</option>
              </select>
              <button id="startTest" class="px-3 py-1 bg-green-500 text-white rounded text-xs font-medium hover:bg-green-600 transition-colors">
                <i class="fa-solid fa-play mr-1"></i>Start
              </button>
              <button id="pauseTest" class="hidden px-3 py-1 bg-yellow-500 text-white rounded text-xs font-medium hover:bg-yellow-600 transition-colors">
                <i class="fa-solid fa-pause mr-1"></i>Pause
              </button>
              <button id="restartTest" class="px-3 py-1 bg-gray-500 text-white rounded text-xs font-medium hover:bg-gray-600 transition-colors">
                <i class="fa-solid fa-refresh mr-1"></i>Restart
              </button>
            </div>
          </div>

          <!-- Live Metrics -->
          <div class="grid grid-cols-3 gap-4 mb-6 p-4 bg-gray-50 rounded-lg">
            <div class="text-center">
              <div class="text-lg font-bold text-blue-600" id="wpmDisplay">0</div>
              <div class="text-xs text-gray-600">WPM</div>
            </div>
            <div class="text-center">
              <div class="text-lg font-bold text-green-600" id="accuracyDisplay">100%</div>
              <div class="text-xs text-gray-600">Accuracy</div>
            </div>
            <div class="text-center">
              <div class="text-lg font-bold text-purple-600" id="timeDisplay">60</div>
              <div class="text-xs text-gray-600">Time</div>
            </div>
          </div>

          <!-- Text Display -->
          <div class="mb-4">
            <div id="textDisplay" class="bg-gray-50 border border-gray-200 rounded-lg p-4 text-sm leading-relaxed min-h-32 font-mono">
              <span class="text-gray-400">Click Start to begin the typing test...</span>
            </div>
          </div>

          <!-- Typing Input -->
          <div class="mb-6">
            <textarea id="typingInput" rows="4" class="w-full px-4 py-3 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 resize-none font-mono" placeholder="Type the text above here..." disabled></textarea>
          </div>

          <!-- Progress Bar -->
          <div class="mb-6">
            <div class="w-full bg-gray-200 rounded-full h-3">
              <div id="progressBar" class="bg-blue-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
          </div>


          <!-- Performance Insights -->
          <div class="mt-6">
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 border border-blue-200">
              <h4 class="font-medium text-gray-800 mb-4 text-sm flex items-center">
                <i class="fa-solid fa-chart-line mr-2 text-blue-600"></i>
                Performance Dashboard
              </h4>
              
              <!-- Main Stats Grid -->
              <div class="grid grid-cols-2 gap-3 mb-4 text-xs">
                <div class="bg-white rounded-lg p-3 text-center shadow-sm border">
                  <div class="font-bold text-blue-600 text-lg" id="avgWPM">--</div>
                  <div class="text-gray-600">Average WPM</div>
                </div>
                <div class="bg-white rounded-lg p-3 text-center shadow-sm border">
                  <div class="font-bold text-green-600 text-lg" id="bestWPM">--</div>
                  <div class="text-gray-600">Best WPM</div>
                </div>
                <div class="bg-white rounded-lg p-3 text-center shadow-sm border">
                  <div class="font-bold text-purple-600 text-lg" id="testsCompleted">0</div>
                  <div class="text-gray-600">Tests Completed</div>
                </div>
                <div class="bg-white rounded-lg p-3 text-center shadow-sm border">
                  <div class="font-bold text-orange-600 text-lg" id="avgAccuracy">--</div>
                  <div class="text-gray-600">Avg Accuracy</div>
                </div>
              </div>

              <!-- Progress Indicators -->
              <div class="space-y-3">
                <div>
                  <div class="flex justify-between items-center mb-1">
                    <span class="text-xs text-gray-600">Typing Consistency</span>
                    <span class="text-xs font-medium text-blue-600" id="consistencyScore">--</span>
                  </div>
                  <div class="w-full bg-gray-200 rounded-full h-2">
                    <div id="consistencyBar" class="bg-blue-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                  </div>
                </div>
                
                <div>
                  <div class="flex justify-between items-center mb-1">
                    <span class="text-xs text-gray-600">Speed Progress</span>
                    <span class="text-xs font-medium text-green-600" id="speedProgress">--</span>
                  </div>
                  <div class="w-full bg-gray-200 rounded-full h-2">
                    <div id="speedBar" class="bg-green-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                  </div>
                </div>
              </div>

              <!-- Quick Actions -->
              <div class="flex gap-2 mt-4">
                <button id="resetStatsBtn" class="flex-1 px-3 py-2 bg-red-100 text-red-700 rounded-lg text-xs font-medium hover:bg-red-200 transition-colors">
                  <i class="fa-solid fa-refresh mr-1"></i>Reset Stats
                </button>
                <button id="exportStatsBtn" class="flex-1 px-3 py-2 bg-blue-100 text-blue-700 rounded-lg text-xs font-medium hover:bg-blue-200 transition-colors">
                  <i class="fa-solid fa-download mr-1"></i>Export Data
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <div class="px-4 pb-4 border-t border-gray-100 mt-auto flex-shrink-0">
          <div class="flex flex-wrap gap-2 pt-3 justify-center">
            <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">Typing</span>
            <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">Speed Test</span>
            <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-medium">WPM</span>
            <span class="px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs font-medium">Practice</span>
          </div>
        </div>
      </div>

      <!-- API Tester Card -->
      <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden flex flex-col h-full" data-aos="fade-up" data-aos-delay="900">
      <!-- Header -->
      <div class="flex items-center justify-between p-4 border-b border-gray-100">
        <h3 class="text-lg font-bold text-gray-800">API Tester</h3>
        <div class="flex items-center gap-2">
          <!-- Environment Selector -->
          <select id="apiEnvironment" class="px-2 sm:px-3 py-1 border border-gray-200 rounded-lg text-xs sm:text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
            <option value="dev">Dev</option>
            <option value="staging">Staging</option>
            <option value="prod">Prod</option>
          </select>
          
          <button id="apiInfoBtn" class="w-8 h-8 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-600 flex items-center justify-center transition-colors" title="Info">
            <i class="fa-solid fa-info text-sm"></i>
          </button>
        </div>
      </div>

      <!-- Main API Tester Area -->
      <div class="p-3 sm:p-4 lg:p-6 flex-1">
        <div class="space-y-4">
          
          <!-- Request Builder (Compact) -->
          <div class="space-y-3">
            <h4 class="font-medium text-gray-800 text-sm flex items-center">
              <i class="fa-solid fa-paper-plane mr-2 text-blue-600"></i>
              Request Builder
            </h4>
            
            <!-- Method & URL -->
            <div class="flex flex-col sm:flex-row gap-2">
              <select id="httpMethod" class="px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 w-full sm:w-auto sm:min-w-24">
                <option value="GET" class="text-green-600">GET</option>
                <option value="POST" class="text-blue-600">POST</option>
                <option value="PUT" class="text-orange-600">PUT</option>
                <option value="PATCH" class="text-yellow-600">PATCH</option>
                <option value="DELETE" class="text-red-600">DELETE</option>
                <option value="OPTIONS" class="text-purple-600">OPTIONS</option>
              </select>
              <input type="text" id="apiUrl" placeholder="https://api.example.com/users" class="flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
            </div>
            
            <!-- Auth Section -->
            <div>
              <label class="block text-xs font-medium text-gray-700 mb-2">Authentication:</label>
              <select id="authType" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 mb-2">
                <option value="none">None</option>
                <option value="bearer">Bearer Token</option>
                <option value="basic">Basic Auth</option>
                <option value="apikey">API Key</option>
              </select>
              <div id="authFields" class="space-y-2 hidden">
                <input type="text" id="authValue" placeholder="Token/Key value" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
                <input type="text" id="authKey" placeholder="Header/Query key (for API Key)" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 hidden">
              </div>
            </div>
            
            <!-- Headers -->
            <div>
              <label class="block text-xs font-medium text-gray-700 mb-2">Headers:</label>
              <div id="headersContainer" class="space-y-2">
                <div class="flex flex-col sm:flex-row gap-2">
                  <input type="text" placeholder="Header name" class="flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 header-key">
                  <input type="text" placeholder="Header value" class="flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 header-value">
                  <button class="px-2 py-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors remove-header w-full sm:w-auto">
                    <i class="fa-solid fa-trash text-sm"></i>
                  </button>
                </div>
              </div>
              <button id="addHeaderBtn" class="mt-2 px-3 py-1 bg-gray-50 text-gray-700 rounded-lg text-sm hover:bg-gray-100 transition-colors">
                <i class="fa-solid fa-plus mr-1"></i>Add Header
              </button>
            </div>
            
            <!-- Query Parameters -->
            <div>
              <label class="block text-xs font-medium text-gray-700 mb-2">Query Parameters:</label>
              <div id="paramsContainer" class="space-y-2">
                <div class="flex flex-col sm:flex-row gap-2">
                  <input type="text" placeholder="Parameter name" class="flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 param-key">
                  <input type="text" placeholder="Parameter value" class="flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 param-value">
                  <button class="px-2 py-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors remove-param w-full sm:w-auto">
                    <i class="fa-solid fa-trash text-sm"></i>
                  </button>
                </div>
              </div>
              <button id="addParamBtn" class="mt-2 px-3 py-1 bg-gray-50 text-gray-700 rounded-lg text-sm hover:bg-gray-100 transition-colors">
                <i class="fa-solid fa-plus mr-1"></i>Add Parameter
              </button>
            </div>
            
            <!-- Request Body -->
            <div id="bodySection" class="hidden">
              <label class="block text-xs font-medium text-gray-700 mb-2">Request Body:</label>
              <div class="mb-2">
                <select id="bodyType" class="px-3 py-1 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
                  <option value="json">JSON</option>
                  <option value="raw">Raw Text</option>
                  <option value="form">Form Data</option>
                </select>
              </div>
              <textarea id="requestBody" rows="4" placeholder='{"key": "value"}' class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 font-mono"></textarea>
              <div class="flex gap-2 mt-2">
                <button id="formatJsonBtn" class="px-3 py-1 bg-blue-50 text-blue-700 rounded-lg text-sm hover:bg-blue-100 transition-colors">
                  <i class="fa-solid fa-magic mr-1"></i>Format JSON
                </button>
                <button id="validateJsonBtn" class="px-3 py-1 bg-green-50 text-green-700 rounded-lg text-sm hover:bg-green-100 transition-colors">
                  <i class="fa-solid fa-check mr-1"></i>Validate
                </button>
              </div>
            </div>
            
            <!-- Send Button -->
            <div class="flex flex-col sm:flex-row gap-2 pt-4">
              <button id="sendRequestBtn" class="flex-1 px-4 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-medium hover:from-blue-600 hover:to-blue-700 transition-all duration-200 transform hover:scale-105 shadow-lg text-sm sm:text-base">
                <i class="fa-solid fa-paper-plane mr-2"></i>Send Request
              </button>
              <button id="cancelRequestBtn" class="px-4 py-3 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors hidden text-sm sm:text-base">
                <i class="fa-solid fa-stop mr-2"></i>Cancel
              </button>
            </div>
            
            <!-- cURL Preview -->
            <div class="bg-gray-50 rounded-lg p-3">
              <div class="flex items-center justify-between mb-2">
                <span class="text-xs font-medium text-gray-700">cURL Command:</span>
                <button id="copyCurlBtn" class="px-2 py-1 bg-white text-gray-600 rounded text-xs hover:bg-gray-100 transition-colors">
                  <i class="fa-solid fa-copy mr-1"></i>Copy
                </button>
              </div>
              <code id="curlPreview" class="block text-xs text-gray-600 font-mono break-all">curl -X GET https://api.example.com/users</code>
            </div>
          </div>
          
          <!-- Response Viewer (Compact) -->
          <div class="space-y-3">
            <h4 class="font-medium text-gray-800 text-sm flex items-center">
              <i class="fa-solid fa-eye mr-2 text-green-600"></i>
              Response Viewer
            </h4>
            
            <!-- Response Status -->
            <div id="responseStatus" class="hidden">
              <div class="flex flex-wrap items-center gap-2 p-3 bg-gray-50 rounded-lg text-xs">
                <div class="flex items-center gap-1">
                  <span class="text-xs text-gray-600">Status:</span>
                  <span id="statusCode" class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs font-medium">200</span>
                  <span id="statusText" class="text-xs text-gray-700">OK</span>
                </div>
                <div class="flex items-center gap-1">
                  <span class="text-xs text-gray-600">Time:</span>
                  <span id="responseTime" class="text-xs font-medium text-blue-600">245ms</span>
                </div>
                <div class="flex items-center gap-1">
                  <span class="text-xs text-gray-600">Size:</span>
                  <span id="responseSize" class="text-xs font-medium text-purple-600">1.2KB</span>
                </div>
              </div>
            </div>
            
            <!-- Response Tabs -->
            <div id="responseTabs" class="hidden">
              <div class="flex border-b border-gray-200 mb-4">
                <button class="response-tab px-4 py-2 text-sm font-medium text-blue-600 border-b-2 border-blue-600" data-tab="body">Response Body</button>
                <button class="response-tab px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-700" data-tab="headers">Headers</button>
                <button class="response-tab px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-700" data-tab="raw">Raw</button>
              </div>
              
              <!-- Response Body Tab -->
              <div id="responseBodyTab" class="response-content">
                <div class="bg-gray-50 rounded-lg p-3 max-h-48 overflow-auto">
                  <pre id="responseBody" class="text-xs text-gray-800 font-mono whitespace-pre-wrap"></pre>
                </div>
                <div class="flex gap-2 mt-2">
                  <button id="copyResponseBtn" class="px-3 py-1 bg-blue-50 text-blue-700 rounded-lg text-sm hover:bg-blue-100 transition-colors">
                    <i class="fa-solid fa-copy mr-1"></i>Copy
                  </button>
                  <button id="downloadResponseBtn" class="px-3 py-1 bg-green-50 text-green-700 rounded-lg text-sm hover:bg-green-100 transition-colors">
                    <i class="fa-solid fa-download mr-1"></i>Download
                  </button>
                </div>
              </div>
              
              <!-- Response Headers Tab -->
              <div id="responseHeadersTab" class="response-content hidden">
                <div class="bg-gray-50 rounded-lg p-3 max-h-48 overflow-auto">
                  <pre id="responseHeaders" class="text-xs text-gray-800 font-mono"></pre>
                </div>
              </div>
              
              <!-- Raw Response Tab -->
              <div id="responseRawTab" class="response-content hidden">
                <div class="bg-gray-50 rounded-lg p-3 max-h-48 overflow-auto">
                  <pre id="responseRaw" class="text-xs text-gray-800 font-mono whitespace-pre-wrap"></pre>
                </div>
              </div>
            </div>
            
            <!-- Loading State -->
            <div id="loadingState" class="flex items-center justify-center p-8 text-gray-500">
              <div class="text-center">
                <i class="fa-solid fa-paper-plane text-2xl mb-2 text-blue-400"></i>
                <p class="text-sm">Ready to send your first request</p>
              </div>
            </div>
            
            <!-- Error State -->
            <div id="errorState" class="hidden bg-red-50 border border-red-200 rounded-lg p-4">
              <div class="flex items-start gap-3">
                <i class="fa-solid fa-exclamation-triangle text-red-500 mt-0.5"></i>
                <div>
                  <h5 class="font-medium text-red-800 mb-1">Request Failed</h5>
                  <p id="errorMessage" class="text-sm text-red-700"></p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="px-4 pb-4 border-t border-gray-100 mt-auto flex-shrink-0">
        <div class="flex flex-wrap gap-2 pt-3 justify-center">
          <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium">🚀 REST API Testing</span>
          <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">🔐 Auth Support</span>
          <span class="px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-xs font-medium">💾 Export/Import</span>
          <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-xs font-medium">📡 Real-time Testing</span>
        </div>
      </div>
      </div>
    </div>
  </div>

  </section>


  <!-- Settings Modal -->
  <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl max-w-md w-full shadow-xl">
      <div class="flex items-center justify-between p-6 border-b border-gray-200">
        <h3 class="text-xl font-bold text-gray-800">API Settings</h3>
        <button id="closeSettings" class="w-8 h-8 rounded-lg hover:bg-gray-100 flex items-center justify-center">
          <i class="fa-solid fa-xmark text-gray-600"></i>
        </button>
      </div>
      <div class="p-6 space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">OpenRouter API Key</label>
          <input 
            id="apiKeyInput" 
            type="password" 
            placeholder="Enter your OpenRouter API key"
            class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
          <p class="text-xs text-gray-500 mt-1">Get your API key from <a href="https://openrouter.ai" target="_blank" class="text-blue-600 hover:underline">openrouter.ai</a></p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">AI Model</label>
          <select id="modelSelect" class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="mistralai/mistral-7b-instruct">Mistral 7B Instruct</option>
            <option value="x-ai/grok-4-fast:free">Grok 4 Fast (Free)</option>
            <option value="meta-llama/llama-3-8b-instruct">Llama 3 8B Instruct</option>
          </select>
        </div>
        <div class="flex gap-3 pt-4">
          <button id="saveSettings" class="flex-1 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors">
            Save Settings
          </button>
          <button id="clearSettings" class="px-4 py-2 border border-gray-200 text-gray-600 rounded-lg hover:bg-gray-50 transition-colors">
            Clear
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Info Modal -->
  <div id="infoModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-2 sm:p-4">
    <div class="bg-white rounded-2xl max-w-lg w-full shadow-xl mx-2 sm:mx-0 max-h-[95vh] sm:max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between p-4 sm:p-6 border-b border-gray-200">
        <h3 class="text-lg sm:text-xl font-bold text-gray-800">Chatbot Playground</h3>
        <button id="closeInfo" class="w-8 h-8 rounded-lg hover:bg-gray-100 flex items-center justify-center">
          <i class="fa-solid fa-xmark text-gray-600"></i>
        </button>
      </div>
      <div class="p-4 sm:p-6 space-y-4">
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">What is this?</h4>
          <p class="text-sm text-gray-600">An interactive AI chatbot that connects to multiple AI models through OpenRouter API. Chat with Mistral, Grok, Llama, and more!</p>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">How to use:</h4>
          <ol class="text-sm text-gray-600 space-y-1 list-decimal list-inside">
            <li>Click the ⚙️ settings icon</li>
            <li>Add your OpenRouter API key</li>
            <li>Choose your preferred AI model</li>
            <li>Save settings and start chatting!</li>
          </ol>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">Features:</h4>
          <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
            <li>Multiple AI models (Mistral 7B, Grok 4 Fast, Llama 3)</li>
            <li>Real-time conversation</li>
            <li>Secure local API key storage</li>
            <li>Clean, responsive interface</li>
          </ul>
        </div>
        <div class="bg-blue-50 p-3 rounded-lg">
          <p class="text-xs text-blue-800">
            <i class="fa-solid fa-info-circle mr-1"></i>
            Your API key is stored locally in your browser and never shared.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Color Palette Info Modal -->
  <div id="paletteInfoModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-2 sm:p-4">
    <div class="bg-white rounded-2xl max-w-lg w-full shadow-xl mx-2 sm:mx-0 max-h-[95vh] sm:max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between p-4 sm:p-6 border-b border-gray-200">
        <h3 class="text-lg sm:text-xl font-bold text-gray-800">Color Palette Generator</h3>
        <button id="closePaletteInfo" class="w-8 h-8 rounded-lg hover:bg-gray-100 flex items-center justify-center">
          <i class="fa-solid fa-xmark text-gray-600"></i>
        </button>
      </div>
      <div class="p-4 sm:p-6 space-y-4">
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">What is this?</h4>
          <p class="text-sm text-gray-600">A professional color palette generator with 16+ aesthetic themes that creates beautiful, harmonious color schemes perfect for design projects.</p>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">How to use:</h4>
          <ol class="text-sm text-gray-600 space-y-1 list-decimal list-inside">
            <li>Choose an aesthetic theme (Pink Aesthetic, Pastels, Earth Tones, etc.)</li>
            <li>Click "Generate" to create new color combinations</li>
            <li>Click any color swatch to copy its HEX code</li>
            <li>Lock colors (🔒) to preserve them when regenerating</li>
            <li>Use "Copy All Hex Codes" to get all colors at once</li>
          </ol>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">Features:</h4>
          <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
            <li>16+ aesthetic color themes</li>
            <li>Lock/unlock individual colors</li>
            <li>HEX and RGB values displayed</li>
            <li>One-click copy to clipboard</li>
            <li>Copy all hex codes as comma-separated list</li>
            <li>Professional color theory algorithms</li>
          </ul>
        </div>
        <div class="bg-pink-50 p-3 rounded-lg">
          <p class="text-xs text-pink-800">
            <i class="fa-solid fa-palette mr-1"></i>
            Choose from 16+ beautiful aesthetic themes to create professional color palettes instantly!
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- 3D Cube Info Modal -->
  <div id="cubeInfoModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-2 sm:p-4">
    <div class="bg-white rounded-2xl max-w-lg w-full shadow-xl mx-2 sm:mx-0 max-h-[95vh] sm:max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between p-4 sm:p-6 border-b border-gray-200">
        <h3 class="text-lg sm:text-xl font-bold text-gray-800">3D Cube Viewer</h3>
        <button id="closeCubeInfo" class="w-8 h-8 rounded-lg hover:bg-gray-100 flex items-center justify-center">
          <i class="fa-solid fa-xmark text-gray-600"></i>
        </button>
      </div>
      <div class="p-4 sm:p-6 space-y-4">
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">What is this?</h4>
          <p class="text-sm text-gray-600">An interactive 3D cube viewer built with Three.js. Drag to rotate, zoom, and explore the cube from different angles with smooth physics-based animations.</p>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">Controls:</h4>
          <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
            <li><strong>Drag:</strong> Click and drag to rotate the cube freely</li>
            <li><strong>Zoom:</strong> Use the slider to zoom in/out (0.5x - 3x)</li>
            <li><strong>Preset Views:</strong> Quick snap to Front, Top, or Side view</li>
            <li><strong>Reset:</strong> Return to default orientation and zoom</li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">Features:</h4>
          <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
            <li>Smooth physics-based rotation with easing</li>
            <li>Real-time 3D rendering with Three.js</li>
            <li>Responsive design that scales on all devices</li>
            <li>Colorful faces with gradient materials</li>
            <li>Interactive controls with visual feedback</li>
          </ul>
        </div>
        <div class="bg-blue-50 p-3 rounded-lg">
          <p class="text-xs text-blue-800">
            <i class="fa-solid fa-cube mr-1"></i>
            Perfect for learning 3D interactions and WebGL capabilities!
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Weather Info Modal -->
  <div id="weatherInfoModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-2 sm:p-4">
    <div class="bg-white rounded-2xl max-w-lg w-full shadow-xl mx-2 sm:mx-0 max-h-[95vh] sm:max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between p-4 sm:p-6 border-b border-gray-200">
        <h3 class="text-lg sm:text-xl font-bold text-gray-800">Weather Widget</h3>
        <button id="closeWeatherInfo" class="w-8 h-8 rounded-lg hover:bg-gray-100 flex items-center justify-center">
          <i class="fa-solid fa-xmark text-gray-600"></i>
        </button>
      </div>
      <div class="p-4 sm:p-6 space-y-4">
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">What is this?</h4>
          <p class="text-sm text-gray-600">A live weather widget that fetches real-time weather data for any city worldwide using the WeatherAPI.com service.</p>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">How to use:</h4>
          <ol class="text-sm text-gray-600 space-y-1 list-decimal list-inside">
            <li>Add your WeatherAPI.com API key in settings (⚙️)</li>
            <li>Type any city name in the search box</li>
            <li>Click "Search" or press Enter</li>
            <li>View live weather data with dynamic backgrounds</li>
          </ol>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">Features:</h4>
          <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
            <li>Real-time weather data updates</li>
            <li>Global city support with country flags</li>
            <li>Dynamic backgrounds based on weather conditions</li>
            <li>Animated weather icons and smooth transitions</li>
            <li>Temperature, humidity, wind speed, and more</li>
          </ul>
        </div>
        <div class="bg-blue-50 p-3 rounded-lg">
          <p class="text-xs text-blue-800">
            <i class="fa-solid fa-cloud mr-1"></i>
            Get your free API key from <a href="https://www.weatherapi.com/" target="_blank" class="underline">WeatherAPI.com</a>
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Weather Settings Modal -->
  <div id="weatherSettingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl max-w-md w-full shadow-xl">
      <div class="flex items-center justify-between p-6 border-b border-gray-200">
        <h3 class="text-xl font-bold text-gray-800">Weather API Settings</h3>
        <button id="closeWeatherSettings" class="w-8 h-8 rounded-lg hover:bg-gray-100 flex items-center justify-center">
          <i class="fa-solid fa-xmark text-gray-600"></i>
        </button>
      </div>
      <div class="p-6 space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">WeatherAPI.com API Key</label>
          <input 
            id="weatherApiKeyInput" 
            type="password" 
            placeholder="Enter your API key"
            class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
          <p class="text-xs text-gray-500 mt-1">Get your free API key from <a href="https://www.weatherapi.com/" target="_blank" class="text-blue-600 hover:underline">weatherapi.com</a></p>
        </div>
        <div class="flex gap-3 pt-4">
          <button id="saveWeatherSettings" class="flex-1 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors">
            Save Settings
          </button>
          <button id="clearWeatherSettings" class="px-4 py-2 border border-gray-200 text-gray-600 rounded-lg hover:bg-gray-50 transition-colors">
            Clear
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Python Console Info Modal -->
  <div id="pythonInfoModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-2 sm:p-4">
    <div class="bg-white rounded-2xl max-w-lg w-full max-h-[95vh] sm:max-h-[90vh] shadow-xl flex flex-col mx-2 sm:mx-0">
      <div class="flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 flex-shrink-0">
        <h3 class="text-lg sm:text-xl font-bold text-gray-800">Python Console</h3>
        <button id="closePythonInfo" class="w-8 h-8 rounded-lg hover:bg-gray-100 flex items-center justify-center">
          <i class="fa-solid fa-xmark text-gray-600"></i>
        </button>
      </div>
      <div class="p-4 sm:p-6 space-y-4 overflow-y-auto flex-1 min-h-0">
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">What is this?</h4>
          <p class="text-sm text-gray-600">A fully interactive Python console that runs real Python code in your browser using Pyodide (Python compiled to WebAssembly).</p>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">How to use:</h4>
          <ol class="text-sm text-gray-600 space-y-1 list-decimal list-inside">
            <li>Type Python commands in the console like a real terminal</li>
            <li>Press Enter to execute single-line commands</li>
            <li>Use Shift+Enter for multi-line code blocks</li>
            <li>View outputs and errors just like in Python IDLE</li>
            <li>Use the Clear button to reset the console</li>
          </ol>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">Features:</h4>
          <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
            <li>Real Python execution with full standard library</li>
            <li>Support for variables, functions, loops, and classes</li>
            <li>Multi-line code support with proper indentation</li>
            <li>Full error tracebacks like real Python</li>
            <li>Persistent variables across commands</li>
            <li>Import and use Python packages</li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">Example Commands:</h4>
          <div class="bg-gray-100 p-3 rounded-lg font-mono text-xs">
            <div class="text-gray-700">print("Hello, World!")</div>
            <div class="text-gray-700">x = 42</div>
            <div class="text-gray-700">for i in range(5): print(i)</div>
          </div>
        </div>
        <div class="bg-green-50 p-3 rounded-lg">
          <p class="text-xs text-green-800">
            <i class="fa-solid fa-code mr-1"></i>
            Powered by Pyodide - full Python 3.11 running in WebAssembly!
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Drawing Canvas Info Modal -->
  <div id="canvasInfoModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-2 sm:p-4">
    <div class="bg-white rounded-2xl max-w-lg w-full shadow-xl mx-2 sm:mx-0 max-h-[95vh] sm:max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between p-4 sm:p-6 border-b border-gray-200">
        <h3 class="text-lg sm:text-xl font-bold text-gray-800">Drawing Canvas</h3>
        <button id="closeCanvasInfo" class="w-8 h-8 rounded-lg hover:bg-gray-100 flex items-center justify-center">
          <i class="fa-solid fa-xmark text-gray-600"></i>
        </button>
      </div>
      <div class="p-4 sm:p-6 space-y-4">
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">What is this?</h4>
          <p class="text-sm text-gray-600">A simple doodle pad where you can draw, erase, pick colors, and download your art as a PNG image.</p>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">How to use:</h4>
          <ol class="text-sm text-gray-600 space-y-1 list-decimal list-inside">
            <li>Select a color using the color picker</li>
            <li>Choose between Draw or Erase tools</li>
            <li>Adjust brush size with the slider</li>
            <li>Click and drag on the canvas to draw</li>
            <li>Use Save button to download your artwork</li>
            <li>Use Clear button to start over</li>
          </ol>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">Features:</h4>
          <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
            <li>Smooth drawing with mouse and touch support</li>
            <li>Color picker for unlimited color choices</li>
            <li>Adjustable brush size (1-20 pixels)</li>
            <li>Eraser tool for corrections</li>
            <li>Download artwork as PNG image</li>
            <li>Responsive canvas that works on all devices</li>
          </ul>
        </div>
        <div class="bg-orange-50 p-3 rounded-lg">
          <p class="text-xs text-orange-800">
            <i class="fa-solid fa-paintbrush mr-1"></i>
            Perfect for quick sketches, doodles, and creative expression!
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Data Visualization Info Modal -->
  <div id="vizInfoModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-2 sm:p-4">
    <div class="bg-white rounded-2xl max-w-lg w-full max-h-[95vh] sm:max-h-[90vh] shadow-xl flex flex-col mx-2 sm:mx-0">
      <div class="flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 flex-shrink-0">
        <h3 class="text-lg sm:text-xl font-bold text-gray-800">Data Visualization Playground</h3>
        <button id="closeVizInfo" class="w-8 h-8 rounded-lg hover:bg-gray-100 flex items-center justify-center">
          <i class="fa-solid fa-xmark text-gray-600"></i>
        </button>
      </div>
      <div class="p-4 sm:p-6 space-y-4 overflow-y-auto flex-1 min-h-0">
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">What is this?</h4>
          <p class="text-sm text-gray-600">A comprehensive data visualization playground where you can upload CSV files or use sample datasets to create interactive charts with Chart.js.</p>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">How to use:</h4>
          <ol class="text-sm text-gray-600 space-y-1 list-decimal list-inside">
            <li>Choose a sample dataset or upload your own CSV file</li>
            <li>Preview your data in the data table</li>
            <li>Select chart type (Bar, Line, Pie, Scatter, Area)</li>
            <li>Map CSV columns to chart axes (X and Y)</li>
            <li>Click "Update Chart" to render visualization</li>
            <li>Export your chart as PNG or download data as CSV</li>
          </ol>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">Features:</h4>
          <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
            <li>Drag & drop CSV file upload</li>
            <li>Multiple sample datasets included</li>
            <li>5 chart types: Bar, Line, Pie, Scatter, Area</li>
            <li>Interactive charts with hover tooltips</li>
            <li>Dynamic column mapping</li>
            <li>Export charts as PNG images</li>
            <li>Download processed data as CSV</li>
            <li>Responsive design for all devices</li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">Sample Datasets:</h4>
          <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
            <li><strong>Sales 2024:</strong> Monthly sales data with revenue figures</li>
            <li><strong>Population by Country:</strong> World population statistics</li>
            <li><strong>Website Traffic:</strong> Daily visitor analytics</li>
          </ul>
        </div>
        <div class="bg-blue-50 p-3 rounded-lg">
          <p class="text-xs text-blue-800">
            <i class="fa-solid fa-chart-bar mr-1"></i>
            Perfect for data analysis, business reporting, and educational purposes!
          </p>
        </div>
      </div>
    </div>
  </div>


  <!-- API Tester Info Modal -->
  <div id="apiInfoModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-2 sm:p-4">
    <div class="bg-white rounded-2xl max-w-lg w-full max-h-[95vh] sm:max-h-[90vh] shadow-xl flex flex-col mx-2 sm:mx-0">
      <div class="flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 flex-shrink-0">
        <h3 class="text-lg sm:text-xl font-bold text-gray-800">API Tester</h3>
        <button id="closeApiInfo" class="w-8 h-8 rounded-lg hover:bg-gray-100 flex items-center justify-center">
          <i class="fa-solid fa-xmark text-gray-600"></i>
        </button>
      </div>
      <div class="p-4 sm:p-6 space-y-4 overflow-y-auto flex-1 min-h-0">
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">What is this?</h4>
          <p class="text-sm text-gray-600">A comprehensive REST API testing tool similar to Postman or Insomnia. Test HTTP requests, manage authentication, view responses, and debug APIs all in your browser.</p>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">Core Features:</h4>
          <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
            <li><strong>HTTP Methods:</strong> GET, POST, PUT, PATCH, DELETE, OPTIONS</li>
            <li><strong>Authentication:</strong> Bearer Token, Basic Auth, API Key</li>
            <li><strong>Headers & Parameters:</strong> Add custom headers and query parameters</li>
            <li><strong>Request Body:</strong> JSON, Raw Text, Form Data support</li>
            <li><strong>Response Viewer:</strong> Formatted JSON, Headers, Raw response tabs</li>
            <li><strong>cURL Export:</strong> Generate and copy cURL commands</li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">Developer Tools:</h4>
          <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
            <li>JSON formatting and validation</li>
            <li>Request history with status codes and timing</li>
            <li>Environment selector (Dev, Staging, Prod)</li>
            <li>Response time and size metrics</li>
            <li>Copy response data to clipboard</li>
            <li>Error handling with CORS guidance</li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">Quick Start:</h4>
          <ol class="text-sm text-gray-600 space-y-1 list-decimal list-inside">
            <li>Enter your API URL (e.g., https://jsonplaceholder.typicode.com/posts)</li>
            <li>Select HTTP method (GET for testing)</li>
            <li>Add headers or auth if needed</li>
            <li>Click "Send Request" to test</li>
            <li>View formatted response in the right panel</li>
          </ol>
        </div>
        <div class="bg-blue-50 p-3 rounded-lg">
          <p class="text-xs text-blue-800">
            <i class="fa-solid fa-shield-alt mr-1"></i>
            <strong>CORS Note:</strong> Some APIs may block browser requests due to CORS policy. Use a CORS proxy or test with public APIs for best results.
          </p>
        </div>
        <div class="bg-green-50 p-3 rounded-lg">
          <p class="text-xs text-green-800">
            <i class="fa-solid fa-rocket mr-1"></i>
            Perfect for API development, testing, and debugging workflows!
          </p>
        </div>
      </div>
    </div>
  </div>


  <!-- Typing Speed Test Info Modal -->
  <div id="typingInfoModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-2 sm:p-4">
    <div class="bg-white rounded-2xl max-w-lg w-full max-h-[95vh] sm:max-h-[90vh] shadow-xl flex flex-col mx-2 sm:mx-0">
      <div class="flex items-center justify-between p-4 sm:p-6 border-b border-gray-200 flex-shrink-0">
        <h3 class="text-lg sm:text-xl font-bold text-gray-800">Typing Speed Test</h3>
        <button id="closeTypingInfo" class="w-8 h-8 rounded-lg hover:bg-gray-100 flex items-center justify-center">
          <i class="fa-solid fa-xmark text-gray-600"></i>
        </button>
      </div>
      <div class="p-4 sm:p-6 space-y-4 overflow-y-auto flex-1 min-h-0">
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">What is this?</h4>
          <p class="text-sm text-gray-600">A comprehensive typing speed test that measures your words per minute (WPM), accuracy, and provides real-time feedback to help improve your typing skills.</p>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">How to use:</h4>
          <ol class="text-sm text-gray-600 space-y-1 list-decimal list-inside">
            <li>Choose your preferred test duration (30s, 1min, 2min)</li>
            <li>Click "Start" to begin the test</li>
            <li>Type the displayed text in the input area below</li>
            <li>Watch your live WPM and accuracy metrics</li>
            <li>Complete the test to see detailed results</li>
            <li>Click "Take Another Test" to try again</li>
          </ol>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">Features:</h4>
          <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
            <li>Real-time WPM and accuracy calculation</li>
            <li>Visual highlighting of correct/incorrect typing</li>
            <li>Multiple test durations available</li>
            <li>Progress bar showing completion</li>
            <li>Detailed results with mistakes count</li>
            <li>Characters per minute (CPM) tracking</li>
            <li>Pause and restart functionality</li>
            <li>Responsive design for all devices</li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-2">Metrics explained:</h4>
          <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
            <li><strong>WPM:</strong> Words per minute (standard 5 characters = 1 word)</li>
            <li><strong>Accuracy:</strong> Percentage of correctly typed characters</li>
            <li><strong>CPM:</strong> Characters per minute including spaces</li>
            <li><strong>Mistakes:</strong> Total number of incorrect keystrokes</li>
          </ul>
        </div>
        <div class="bg-green-50 p-3 rounded-lg">
          <p class="text-xs text-green-800">
            <i class="fa-solid fa-keyboard mr-1"></i>
            Practice regularly to improve your typing speed and accuracy!
          </p>
        </div>
      </div>
    </div>
  </div>


  <!-- AOS Animation Library -->
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <script>
    // Disable AOS to prevent auto-scrolling
    // AOS.init({
    //   duration: 600,
    //   easing: 'ease-out-cubic',
    //   once: true
    // });

    // Custom smooth scroll function that doesn't auto-scroll on page load
    function scrollToGallery() {
      const gallery = document.getElementById('gallery');
      if (gallery) {
        gallery.scrollIntoView({ 
          behavior: 'smooth', 
          block: 'start' 
        });
      }
    }

    // Chatbot functionality
    const settingsBtn = document.getElementById('settingsBtn');
    const infoBtn = document.getElementById('infoBtn');
    const settingsModal = document.getElementById('settingsModal');
    const infoModal = document.getElementById('infoModal');
    const closeSettings = document.getElementById('closeSettings');
    const closeInfo = document.getElementById('closeInfo');
    const saveSettings = document.getElementById('saveSettings');
    const clearSettings = document.getElementById('clearSettings');
    const apiKeyInput = document.getElementById('apiKeyInput');
    const modelSelect = document.getElementById('modelSelect');
    const messageInput = document.getElementById('messageInput');
    const sendBtn = document.getElementById('sendBtn');
    const chatMessages = document.getElementById('chatMessages');
    const typingIndicator = document.getElementById('typingIndicator');

    let conversationHistory = [];

    // Load saved settings
    function loadSettings() {
      const apiKey = localStorage.getItem('openrouter_api_key');
      const model = localStorage.getItem('openrouter_model');
      
      if (apiKey) {
        apiKeyInput.value = apiKey;
        messageInput.disabled = false;
        sendBtn.disabled = false;
        updateWelcomeMessage('Ready to chat! Ask me anything.');
      }
      
      if (model) {
        modelSelect.value = model;
      }
    }

    // Update welcome message
    function updateWelcomeMessage(text) {
      const welcomeMsg = chatMessages.querySelector('.bg-white p');
      if (welcomeMsg) {
        welcomeMsg.textContent = text;
      }
    }

    // Modal controls
    settingsBtn.addEventListener('click', () => {
      settingsModal.classList.remove('hidden');
    });

    infoBtn.addEventListener('click', () => {
      infoModal.classList.remove('hidden');
    });

    closeSettings.addEventListener('click', () => {
      settingsModal.classList.add('hidden');
    });

    closeInfo.addEventListener('click', () => {
      infoModal.classList.add('hidden');
    });

    // Close modals when clicking outside
    settingsModal.addEventListener('click', (e) => {
      if (e.target === settingsModal) {
        settingsModal.classList.add('hidden');
      }
    });

    infoModal.addEventListener('click', (e) => {
      if (e.target === infoModal) {
        infoModal.classList.add('hidden');
      }
    });


    // Save settings
    saveSettings.addEventListener('click', () => {
      const apiKey = apiKeyInput.value.trim();
      const model = modelSelect.value;
      
      if (apiKey) {
        localStorage.setItem('openrouter_api_key', apiKey);
        localStorage.setItem('openrouter_model', model);
        messageInput.disabled = false;
        updateWelcomeMessage('Settings saved! Ready to chat.');
        settingsModal.classList.add('hidden');
        updateSendButtonState();
      } else {
        alert('Please enter your OpenRouter API key');
      }
    });

    // Clear settings
    clearSettings.addEventListener('click', () => {
      if (confirm('Are you sure you want to clear all settings?')) {
        localStorage.removeItem('openrouter_api_key');
        localStorage.removeItem('openrouter_model');
        apiKeyInput.value = '';
        modelSelect.value = 'mistralai/mistral-7b-instruct';
        messageInput.disabled = true;
        updateWelcomeMessage('Settings cleared. Add your API key to start chatting.');
        settingsModal.classList.add('hidden');
        updateSendButtonState();
      }
    });

    // Add message to chat
    function addMessage(content, isUser = false) {
      const messageDiv = document.createElement('div');
      messageDiv.className = 'flex items-start gap-2';
      
      if (isUser) {
        messageDiv.className += ' flex-row-reverse';
        messageDiv.innerHTML = `
          <div class="w-8 h-8 bg-gradient-to-r from-pink-500 to-red-500 rounded-full flex items-center justify-center text-white text-sm flex-shrink-0">
            <i class="fa-solid fa-user"></i>
          </div>
          <div class="bg-blue-500 text-white rounded-lg px-3 py-2 shadow-sm max-w-xs">
            <p class="text-sm">${content}</p>
          </div>
        `;
      } else {
        messageDiv.innerHTML = `
          <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-sm flex-shrink-0">
            <i class="fa-solid fa-robot"></i>
          </div>
          <div class="bg-white rounded-lg px-3 py-2 shadow-sm max-w-xs">
            <p class="text-sm text-gray-700">${content}</p>
          </div>
        `;
      }
      
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Show/hide typing indicator
    function showTyping(show = true) {
      if (show) {
        typingIndicator.classList.remove('hidden');
      } else {
        typingIndicator.classList.add('hidden');
      }
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Send message
    async function sendMessage() {
      const message = messageInput.value.trim();
      if (!message) return;

      const apiKey = localStorage.getItem('openrouter_api_key');
      if (!apiKey) {
        alert('Please add your API key in settings first.');
        return;
      }

      // Add user message
      addMessage(message, true);
      conversationHistory.push({ role: 'user', content: message });
      
      // Clear input and show typing
      messageInput.value = '';
      showTyping(true);

      try {
        const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${apiKey}`,
            'Content-Type': 'application/json',
            'HTTP-Referer': window.location.origin,
            'X-Title': 'Chatbot Playground'
          },
          body: JSON.stringify({
            model: localStorage.getItem('openrouter_model') || 'mistralai/mistral-7b-instruct',
            messages: [
              {
                role: 'system',
                content: 'You are a helpful AI assistant. Provide clear, concise, and helpful responses.'
              },
              ...conversationHistory.slice(-10) // Keep last 10 messages for context
            ],
            temperature: 0.7,
            max_tokens: 500,
            stream: false
          })
        });

        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          throw new Error(`API Error ${response.status}: ${errorData.error?.message || 'Unknown error'}`);
        }

        const data = await response.json();
        
        const aiResponse = data.choices?.[0]?.message?.content || 'Sorry, I could not generate a response.';
        
        // Add AI response
        showTyping(false);
        addMessage(aiResponse, false);
        conversationHistory.push({ role: 'assistant', content: aiResponse });
        updateSendButtonState();
        
      } catch (error) {
        console.error('Chat error:', error);
        showTyping(false);
        
        let errorMessage = 'Sorry, I encountered an error: ';
        if (error.message.includes('401') || error.message.includes('authentication')) {
          errorMessage += 'Invalid API key. Please check your OpenRouter API key in settings.';
        } else if (error.message.includes('429') || error.message.includes('rate limit')) {
          errorMessage += 'Rate limit exceeded. Please try again in a moment.';
        } else if (error.message.includes('402') || error.message.includes('insufficient')) {
          errorMessage += 'Insufficient credits. Try using Grok 4 Fast (Free) model.';
        } else if (error.message.includes('400')) {
          errorMessage += 'Invalid request. The selected model might not be available.';
        } else if (error.message.includes('network') || error.name === 'TypeError') {
          errorMessage += 'Network error. Please check your internet connection.';
        } else {
          errorMessage += error.message || 'Unknown error occurred.';
        }
        
        addMessage(errorMessage, false);
        updateSendButtonState();
      }
    }

    // Send message on Enter
    messageInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // Send button click
    sendBtn.addEventListener('click', sendMessage);

    // Enable/disable send button based on input
    messageInput.addEventListener('input', () => {
      const hasText = messageInput.value.trim().length > 0;
      const hasApiKey = localStorage.getItem('openrouter_api_key');
      sendBtn.disabled = !hasText || !hasApiKey || messageInput.disabled;
    });

    // Fix send button initial state
    function updateSendButtonState() {
      const hasText = messageInput.value.trim().length > 0;
      const hasApiKey = localStorage.getItem('openrouter_api_key');
      sendBtn.disabled = !hasText || !hasApiKey || messageInput.disabled;
    }

    // Load settings on page load
    loadSettings();
    
    // Update send button state after loading settings
    setTimeout(() => {
      updateSendButtonState();
    }, 100);

    // ===== ADVANCED COLOR PALETTE GENERATOR =====
    const paletteInfoBtn = document.getElementById('paletteInfoBtn');
    const paletteInfoModal = document.getElementById('paletteInfoModal');
    const closePaletteInfo = document.getElementById('closePaletteInfo');
    const colorSwatches = document.getElementById('colorSwatches');
    const paletteMode = document.getElementById('paletteMode');
    const generatePaletteBtn = document.getElementById('generatePaletteBtn');
    const copyAllBtn = document.getElementById('copyAllBtn');

    let currentPalette = [];
    let lockedColors = [false, false, false, false, false];

    // Utility functions
    function hexToRgb(hex) {
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      return { r, g, b };
    }

    function hexToHsl(hex) {
      const { r, g, b } = hexToRgb(hex);
      const rNorm = r / 255;
      const gNorm = g / 255;
      const bNorm = b / 255;
      
      const max = Math.max(rNorm, gNorm, bNorm);
      const min = Math.min(rNorm, gNorm, bNorm);
      let h, s, l = (max + min) / 2;
      
      if (max === min) {
        h = s = 0;
      } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case rNorm: h = (gNorm - bNorm) / d + (gNorm < bNorm ? 6 : 0); break;
          case gNorm: h = (bNorm - rNorm) / d + 2; break;
          case bNorm: h = (rNorm - gNorm) / d + 4; break;
        }
        h /= 6;
      }
      
      return { h: h * 360, s: s * 100, l: l * 100 };
    }

    function hslToHex(h, s, l) {
      h /= 360; s /= 100; l /= 100;
      
      const hue2rgb = (p, q, t) => {
        if (t < 0) t += 1;
        if (t > 1) t -= 1;
        if (t < 1/6) return p + (q - p) * 6 * t;
        if (t < 1/2) return q;
        if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
        return p;
      };
      
      let r, g, b;
      if (s === 0) {
        r = g = b = l;
      } else {
        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        const p = 2 * l - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);
      }
      
      const toHex = (c) => {
        const hex = Math.round(c * 255).toString(16);
        return hex.length === 1 ? '0' + hex : hex;
      };
      
      return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
    }

    // Generate aesthetic color palettes
    function generatePalette(mode) {
      const colors = [];
      
      switch (mode) {
        case 'pink-aesthetic':
          const pinkBase = 320 + Math.random() * 40;
          colors.push(hslToHex(pinkBase, 70, 85));      // Light pink
          colors.push(hslToHex(pinkBase, 60, 70));      // Medium pink
          colors.push(hslToHex(pinkBase, 80, 55));      // Deep pink
          colors.push(hslToHex(pinkBase + 20, 50, 80)); // Peachy pink
          colors.push(hslToHex(pinkBase - 30, 40, 75)); // Lavender pink
          break;
          
        case 'pastels':
          const pastelHues = [0, 60, 120, 180, 300];
          pastelHues.forEach(hue => {
            colors.push(hslToHex(hue + Math.random() * 30, 40 + Math.random() * 20, 80 + Math.random() * 15));
          });
          break;
          
        case 'earth-tones':
          colors.push(hslToHex(30, 60, 45));   // Brown
          colors.push(hslToHex(25, 50, 60));   // Tan
          colors.push(hslToHex(35, 40, 35));   // Dark brown
          colors.push(hslToHex(45, 70, 70));   // Beige
          colors.push(hslToHex(20, 45, 25));   // Dark earth
          break;
          
        case 'ocean-vibes':
          const oceanBase = 200 + Math.random() * 40;
          colors.push(hslToHex(oceanBase, 70, 85));     // Light blue
          colors.push(hslToHex(oceanBase, 80, 60));     // Ocean blue
          colors.push(hslToHex(oceanBase + 20, 60, 70)); // Teal
          colors.push(hslToHex(oceanBase - 20, 50, 40)); // Deep blue
          colors.push(hslToHex(oceanBase + 40, 45, 75)); // Aqua
          break;
          
        case 'sunset-warm':
          colors.push(hslToHex(15, 80, 70));   // Coral
          colors.push(hslToHex(35, 85, 65));   // Orange
          colors.push(hslToHex(50, 75, 75));   // Yellow
          colors.push(hslToHex(5, 70, 60));    // Red-orange
          colors.push(hslToHex(320, 60, 80));  // Pink
          break;
          
        case 'forest-green':
          const greenBase = 120 + Math.random() * 60;
          colors.push(hslToHex(greenBase, 40, 85));     // Light green
          colors.push(hslToHex(greenBase, 60, 60));     // Medium green
          colors.push(hslToHex(greenBase, 70, 35));     // Dark green
          colors.push(hslToHex(greenBase + 30, 50, 70)); // Yellow-green
          colors.push(hslToHex(greenBase - 30, 45, 45)); // Blue-green
          break;
          
        case 'lavender-dream':
          const lavenderBase = 270 + Math.random() * 30;
          colors.push(hslToHex(lavenderBase, 50, 90));   // Very light lavender
          colors.push(hslToHex(lavenderBase, 60, 80));   // Light lavender
          colors.push(hslToHex(lavenderBase, 70, 65));   // Medium lavender
          colors.push(hslToHex(lavenderBase + 20, 45, 85)); // Light purple
          colors.push(hslToHex(lavenderBase - 20, 55, 75)); // Lilac
          break;
          
        case 'vintage-cream':
          colors.push(hslToHex(45, 30, 90));   // Cream
          colors.push(hslToHex(35, 40, 85));   // Warm white
          colors.push(hslToHex(25, 50, 75));   // Beige
          colors.push(hslToHex(15, 35, 80));   // Off-white
          colors.push(hslToHex(55, 25, 70));   // Pale yellow
          break;
          
        case 'neon-bright':
          colors.push(hslToHex(300, 100, 50)); // Neon pink
          colors.push(hslToHex(60, 100, 50));  // Neon yellow
          colors.push(hslToHex(120, 100, 50)); // Neon green
          colors.push(hslToHex(180, 100, 50)); // Neon cyan
          colors.push(hslToHex(240, 100, 50)); // Neon blue
          break;
          
        case 'autumn-spice':
          colors.push(hslToHex(25, 70, 50));   // Burnt orange
          colors.push(hslToHex(45, 80, 45));   // Golden brown
          colors.push(hslToHex(15, 60, 40));   // Deep rust
          colors.push(hslToHex(35, 65, 60));   // Warm amber
          colors.push(hslToHex(5, 75, 35));    // Dark red-brown
          break;
          
        case 'midnight-dark':
          colors.push(hslToHex(240, 30, 15));  // Dark navy
          colors.push(hslToHex(260, 25, 20));  // Deep purple
          colors.push(hslToHex(220, 35, 25));  // Dark blue
          colors.push(hslToHex(280, 20, 18));  // Dark violet
          colors.push(hslToHex(200, 40, 12));  // Midnight blue
          break;
          
        case 'coral-reef':
          colors.push(hslToHex(15, 80, 70));   // Coral
          colors.push(hslToHex(25, 75, 65));   // Peach
          colors.push(hslToHex(5, 85, 60));    // Salmon
          colors.push(hslToHex(35, 70, 75));   // Light coral
          colors.push(hslToHex(345, 80, 65));  // Pink coral
          break;
          
        case 'sage-mint':
          colors.push(hslToHex(150, 30, 70));  // Sage green
          colors.push(hslToHex(160, 40, 75));  // Mint
          colors.push(hslToHex(140, 25, 65));  // Muted green
          colors.push(hslToHex(170, 35, 80));  // Light mint
          colors.push(hslToHex(130, 20, 60));  // Dusty sage
          break;
          
        case 'berry-wine':
          colors.push(hslToHex(330, 70, 45));  // Berry
          colors.push(hslToHex(340, 80, 40));  // Wine red
          colors.push(hslToHex(320, 65, 50));  // Plum
          colors.push(hslToHex(350, 75, 35));  // Deep wine
          colors.push(hslToHex(310, 60, 55));  // Mauve
          break;
          
        case 'golden-hour':
          colors.push(hslToHex(45, 85, 65));   // Golden yellow
          colors.push(hslToHex(35, 80, 60));   // Warm gold
          colors.push(hslToHex(25, 75, 55));   // Amber
          colors.push(hslToHex(55, 70, 70));   // Light gold
          colors.push(hslToHex(15, 85, 50));   // Bronze
          break;
          
        case 'arctic-cool':
          colors.push(hslToHex(200, 50, 85));  // Ice blue
          colors.push(hslToHex(210, 40, 90));  // Frost white
          colors.push(hslToHex(190, 60, 80));  // Cool blue
          colors.push(hslToHex(220, 30, 95));  // Snow white
          colors.push(hslToHex(180, 45, 75));  // Arctic blue
          break;
          
        case 'monochrome':
          const baseHue = Math.random() * 360;
          const baseSat = 60 + Math.random() * 30;
          for (let i = 0; i < 5; i++) {
            colors.push(hslToHex(baseHue, baseSat, 20 + i * 15));
          }
          break;
          
        case 'random':
        default:
          for (let i = 0; i < 5; i++) {
            colors.push(hslToHex(Math.random() * 360, 60 + Math.random() * 30, 45 + Math.random() * 30));
          }
          break;
      }
      
      return colors;
    }

    // Create swatch element
    function createSwatch(color, index) {
      const { r, g, b } = hexToRgb(color);
      const isLocked = lockedColors[index];
      
      return `
        <div class="relative group">
          <div class="w-full h-20 rounded-lg shadow-md cursor-pointer transition-transform hover:scale-105 relative overflow-hidden" 
               style="background-color: ${color};" 
               onclick="copyColorToClipboard('${color}')">
            <button class="absolute top-1 right-1 w-6 h-6 bg-white/80 rounded-full flex items-center justify-center text-xs hover:bg-white transition-colors ${isLocked ? 'text-red-500' : 'text-gray-500'}" 
                    onclick="event.stopPropagation(); toggleLock(${index})" 
                    title="${isLocked ? 'Unlock color' : 'Lock color'}">
              <i class="fa-solid fa-${isLocked ? 'lock' : 'lock-open'}"></i>
            </button>
          </div>
          <div class="mt-2 text-center">
            <div class="font-mono text-xs font-semibold text-gray-800">${color.toUpperCase()}</div>
            <div class="text-xs text-gray-500">RGB(${r}, ${g}, ${b})</div>
          </div>
        </div>
      `;
    }

    // Update swatches display
    function updateSwatches() {
      colorSwatches.innerHTML = currentPalette.map((color, index) => createSwatch(color, index)).join('');
    }

    // Toggle lock on color
    function toggleLock(index) {
      lockedColors[index] = !lockedColors[index];
      updateSwatches();
    }

    // Copy color to clipboard
    async function copyColorToClipboard(color) {
      try {
        await navigator.clipboard.writeText(color);
        showToast(`Copied ${color}!`, 'success');
      } catch (err) {
        console.error('Failed to copy color:', err);
        showToast('Failed to copy color', 'error');
      }
    }

    // Copy all colors as hex codes
    async function copyAllAsHex() {
      const hexCodes = currentPalette.join(', ');
      
      try {
        await navigator.clipboard.writeText(hexCodes);
        showToast('Copied all hex codes!', 'success');
      } catch (err) {
        console.error('Failed to copy hex codes:', err);
        showToast('Failed to copy hex codes', 'error');
      }
    }

    // Show toast notification
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `fixed top-4 right-4 px-4 py-2 rounded-lg text-white text-sm z-50 transition-all transform translate-x-full ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => toast.classList.remove('translate-x-full'), 100);
      setTimeout(() => {
        toast.classList.add('translate-x-full');
        setTimeout(() => document.body.removeChild(toast), 300);
      }, 2000);
    }

    // Generate new palette
    function generateNewPalette() {
      const newColors = generatePalette(paletteMode.value);
      
      // Only update unlocked colors
      newColors.forEach((color, index) => {
        if (!lockedColors[index]) {
          currentPalette[index] = color;
        }
      });
      
      updateSwatches();
    }

    // Event listeners
    if (paletteInfoBtn) {
      paletteInfoBtn.addEventListener('click', () => paletteInfoModal.classList.remove('hidden'));
    }
    
    if (closePaletteInfo) {
      closePaletteInfo.addEventListener('click', () => paletteInfoModal.classList.add('hidden'));
    }
    
    if (paletteInfoModal) {
      paletteInfoModal.addEventListener('click', (e) => {
        if (e.target === paletteInfoModal) paletteInfoModal.classList.add('hidden');
      });
    }
    
    if (generatePaletteBtn) {
      generatePaletteBtn.addEventListener('click', generateNewPalette);
    }
    
    if (copyAllBtn) {
      copyAllBtn.addEventListener('click', copyAllAsHex);
    }

    // Make functions global for onclick handlers
    window.toggleLock = toggleLock;
    window.copyColorToClipboard = copyColorToClipboard;

    // Initialize palette
    currentPalette = generatePalette('pink-aesthetic');
    updateSwatches();

    // ===== 3D CUBE VIEWER =====
    const cubeInfoBtn = document.getElementById('cubeInfoBtn');
    const cubeInfoModal = document.getElementById('cubeInfoModal');
    const closeCubeInfo = document.getElementById('closeCubeInfo');
    const cubeContainer = document.getElementById('cubeContainer');
    const zoomSlider = document.getElementById('zoomSlider');
    const frontView = document.getElementById('frontView');
    const topView = document.getElementById('topView');
    const sideView = document.getElementById('sideView');
    const resetCube = document.getElementById('resetCube');

    let scene, camera, renderer, cube, controls;
    let isMouseDown = false;
    let mouseX = 0, mouseY = 0;
    let targetRotationX = 0, targetRotationY = 0;
    let currentRotationX = 0, currentRotationY = 0;

    // Initialize 3D scene
    function init3DCube() {
      if (!cubeContainer) return;

      // Scene setup
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, cubeContainer.offsetWidth / cubeContainer.offsetHeight, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      
      renderer.setSize(cubeContainer.offsetWidth, cubeContainer.offsetHeight);
      renderer.setClearColor(0x000000, 0);
      cubeContainer.appendChild(renderer.domElement);

      // Create cube geometry with rounded edges
      const geometry = new THREE.BoxGeometry(2.2, 2.2, 2.2);
      
      // Create attractive materials for each face with gradients and shine
      const materials = [
        new THREE.MeshPhongMaterial({ 
          color: 0xff4757, 
          shininess: 100,
          specular: 0x222222,
          transparent: true,
          opacity: 0.9
        }), // Right - Vibrant Red
        new THREE.MeshPhongMaterial({ 
          color: 0x2ed573, 
          shininess: 100,
          specular: 0x222222,
          transparent: true,
          opacity: 0.9
        }), // Left - Vibrant Green
        new THREE.MeshPhongMaterial({ 
          color: 0x3742fa, 
          shininess: 100,
          specular: 0x222222,
          transparent: true,
          opacity: 0.9
        }), // Top - Vibrant Blue
        new THREE.MeshPhongMaterial({ 
          color: 0xf1c40f, 
          shininess: 100,
          specular: 0x222222,
          transparent: true,
          opacity: 0.9
        }), // Bottom - Vibrant Yellow
        new THREE.MeshPhongMaterial({ 
          color: 0xe056fd, 
          shininess: 100,
          specular: 0x222222,
          transparent: true,
          opacity: 0.9
        }), // Front - Vibrant Purple
        new THREE.MeshPhongMaterial({ 
          color: 0xff6348, 
          shininess: 100,
          specular: 0x222222,
          transparent: true,
          opacity: 0.9
        })  // Back - Vibrant Orange
      ];

      cube = new THREE.Mesh(geometry, materials);
      
      // Add subtle rotation for initial appeal
      cube.rotation.x = 0.2;
      cube.rotation.y = 0.2;
      
      scene.add(cube);

      // Position camera
      camera.position.z = 5;

      // Enhanced lighting setup
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
      scene.add(ambientLight);
      
      const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.8);
      directionalLight1.position.set(2, 2, 2);
      scene.add(directionalLight1);
      
      const directionalLight2 = new THREE.DirectionalLight(0x4a90e2, 0.3);
      directionalLight2.position.set(-2, -1, 1);
      scene.add(directionalLight2);
      
      // Add point light for extra shine
      const pointLight = new THREE.PointLight(0xffffff, 0.5, 10);
      pointLight.position.set(0, 0, 3);
      scene.add(pointLight);

      // Mouse controls
      setupMouseControls();
      
      // Start animation loop
      animate();
    }

    // Setup mouse controls
    function setupMouseControls() {
      const canvas = renderer.domElement;

      canvas.addEventListener('mousedown', onMouseDown);
      canvas.addEventListener('mousemove', onMouseMove);
      canvas.addEventListener('mouseup', onMouseUp);
      canvas.addEventListener('mouseleave', onMouseUp);

      // Touch controls for mobile
      canvas.addEventListener('touchstart', onTouchStart);
      canvas.addEventListener('touchmove', onTouchMove);
      canvas.addEventListener('touchend', onTouchEnd);
    }

    function onMouseDown(event) {
      isMouseDown = true;
      mouseX = event.clientX;
      mouseY = event.clientY;
    }

    function onMouseMove(event) {
      if (!isMouseDown) return;
      
      const deltaX = event.clientX - mouseX;
      const deltaY = event.clientY - mouseY;
      
      targetRotationY += deltaX * 0.01;
      targetRotationX += deltaY * 0.01;
      
      mouseX = event.clientX;
      mouseY = event.clientY;
    }

    function onMouseUp() {
      isMouseDown = false;
    }

    // Touch controls
    function onTouchStart(event) {
      event.preventDefault();
      const touch = event.touches[0];
      mouseX = touch.clientX;
      mouseY = touch.clientY;
      isMouseDown = true;
    }

    function onTouchMove(event) {
      event.preventDefault();
      if (!isMouseDown) return;
      
      const touch = event.touches[0];
      const deltaX = touch.clientX - mouseX;
      const deltaY = touch.clientY - mouseY;
      
      targetRotationY += deltaX * 0.01;
      targetRotationX += deltaY * 0.01;
      
      mouseX = touch.clientX;
      mouseY = touch.clientY;
    }

    function onTouchEnd(event) {
      event.preventDefault();
      isMouseDown = false;
    }

    // Animation loop
    function animate() {
      requestAnimationFrame(animate);
      
      // Smooth rotation with easing
      currentRotationX += (targetRotationX - currentRotationX) * 0.1;
      currentRotationY += (targetRotationY - currentRotationY) * 0.1;
      
      cube.rotation.x = currentRotationX;
      cube.rotation.y = currentRotationY;
      
      renderer.render(scene, camera);
    }

    // Zoom control
    if (zoomSlider) {
      zoomSlider.addEventListener('input', (e) => {
        const zoom = parseFloat(e.target.value);
        camera.position.z = 5 / zoom;
      });
    }

    // Preset views with smooth transitions
    function animateToRotation(x, y, duration = 1000) {
      const startX = currentRotationX;
      const startY = currentRotationY;
      const startTime = Date.now();
      
      function updateRotation() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        // Easing function
        const easeProgress = 1 - Math.pow(1 - progress, 3);
        
        targetRotationX = startX + (x - startX) * easeProgress;
        targetRotationY = startY + (y - startY) * easeProgress;
        
        if (progress < 1) {
          requestAnimationFrame(updateRotation);
        }
      }
      
      updateRotation();
    }

    // Preset view buttons
    if (frontView) {
      frontView.addEventListener('click', () => {
        animateToRotation(0, 0);
      });
    }

    if (topView) {
      topView.addEventListener('click', () => {
        animateToRotation(-Math.PI / 2, 0);
      });
    }

    if (sideView) {
      sideView.addEventListener('click', () => {
        animateToRotation(0, Math.PI / 2);
      });
    }

    if (resetCube) {
      resetCube.addEventListener('click', () => {
        animateToRotation(0.2, 0.2);
        if (zoomSlider) {
          zoomSlider.value = 1;
          camera.position.z = 5;
        }
      });
    }

    // Modal controls
    if (cubeInfoBtn) {
      cubeInfoBtn.addEventListener('click', () => {
        cubeInfoModal.classList.remove('hidden');
      });
    }

    if (closeCubeInfo) {
      closeCubeInfo.addEventListener('click', () => {
        cubeInfoModal.classList.add('hidden');
      });
    }

    if (cubeInfoModal) {
      cubeInfoModal.addEventListener('click', (e) => {
        if (e.target === cubeInfoModal) {
          cubeInfoModal.classList.add('hidden');
        }
      });
    }

    // Handle window resize
    function onWindowResize() {
      if (!camera || !renderer || !cubeContainer) return;
      
      camera.aspect = cubeContainer.offsetWidth / cubeContainer.offsetHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(cubeContainer.offsetWidth, cubeContainer.offsetHeight);
    }

    window.addEventListener('resize', onWindowResize);

    // Initialize 3D cube when page loads
    setTimeout(() => {
      init3DCube();
    }, 500);

    // ===== WEATHER WIDGET =====
    const weatherInfoBtn = document.getElementById('weatherInfoBtn');
    const weatherSettingsBtn = document.getElementById('weatherSettingsBtn');
    const weatherInfoModal = document.getElementById('weatherInfoModal');
    const weatherSettingsModal = document.getElementById('weatherSettingsModal');
    const closeWeatherInfo = document.getElementById('closeWeatherInfo');
    const closeWeatherSettings = document.getElementById('closeWeatherSettings');
    const saveWeatherSettings = document.getElementById('saveWeatherSettings');
    const clearWeatherSettings = document.getElementById('clearWeatherSettings');
    const weatherApiKeyInput = document.getElementById('weatherApiKeyInput');
    const cityInput = document.getElementById('cityInput');
    const searchWeather = document.getElementById('searchWeather');
    const weatherDisplay = document.getElementById('weatherDisplay');
    const weatherContent = document.getElementById('weatherContent');
    const weatherLoading = document.getElementById('weatherLoading');

    // Weather icon mapping for WeatherAPI.com conditions
    const weatherIcons = {
      'sunny': '☀️',
      'clear': '☀️',
      'partly cloudy': '🌤️',
      'cloudy': '☁️',
      'overcast': '☁️',
      'mist': '🌫️',
      'patchy rain possible': '🌦️',
      'patchy snow possible': '🌨️',
      'patchy sleet possible': '🌨️',
      'patchy freezing drizzle possible': '🌨️',
      'thundery outbreaks possible': '⛈️',
      'blowing snow': '❄️',
      'blizzard': '❄️',
      'fog': '🌫️',
      'freezing fog': '🌫️',
      'patchy light drizzle': '🌦️',
      'light drizzle': '🌦️',
      'freezing drizzle': '🌨️',
      'heavy freezing drizzle': '🌨️',
      'patchy light rain': '🌦️',
      'light rain': '🌧️',
      'moderate rain at times': '🌧️',
      'moderate rain': '🌧️',
      'heavy rain at times': '🌧️',
      'heavy rain': '🌧️',
      'light freezing rain': '🌨️',
      'moderate or heavy freezing rain': '🌨️',
      'light sleet': '🌨️',
      'moderate or heavy sleet': '🌨️',
      'patchy light snow': '❄️',
      'light snow': '❄️',
      'patchy moderate snow': '❄️',
      'moderate snow': '❄️',
      'patchy heavy snow': '❄️',
      'heavy snow': '❄️',
      'ice pellets': '🌨️',
      'light rain shower': '🌦️',
      'moderate or heavy rain shower': '🌧️',
      'torrential rain shower': '🌧️',
      'light sleet showers': '🌨️',
      'moderate or heavy sleet showers': '🌨️',
      'light snow showers': '❄️',
      'moderate or heavy snow showers': '❄️',
      'light showers of ice pellets': '🌨️',
      'moderate or heavy showers of ice pellets': '🌨️',
      'patchy light rain with thunder': '⛈️',
      'moderate or heavy rain with thunder': '⛈️',
      'patchy light snow with thunder': '⛈️',
      'moderate or heavy snow with thunder': '⛈️'
    };

    // Weather background gradients
    const weatherBackgrounds = {
      'sunny': 'from-yellow-400 to-orange-500',
      'clear': 'from-yellow-400 to-orange-500',
      'partly cloudy': 'from-blue-300 to-blue-500',
      'cloudy': 'from-gray-400 to-gray-600',
      'overcast': 'from-gray-500 to-gray-700',
      'rain': 'from-blue-500 to-blue-700',
      'drizzle': 'from-blue-400 to-blue-600',
      'thunderstorm': 'from-gray-700 to-gray-900',
      'snow': 'from-blue-200 to-blue-400',
      'mist': 'from-gray-300 to-gray-500',
      'fog': 'from-gray-300 to-gray-500'
    };

    // Load weather settings
    function loadWeatherSettings() {
      const apiKey = localStorage.getItem('weather_api_key');
      if (apiKey) {
        weatherApiKeyInput.value = apiKey;
      }
    }

    // Get weather icon
    function getWeatherIcon(condition) {
      const conditionLower = condition.toLowerCase();
      
      // Direct match first
      if (weatherIcons[conditionLower]) {
        return weatherIcons[conditionLower];
      }
      
      // Partial matches for better coverage
      if (conditionLower.includes('sunny') || conditionLower.includes('clear')) return '☀️';
      if (conditionLower.includes('partly cloudy')) return '🌤️';
      if (conditionLower.includes('cloudy') || conditionLower.includes('overcast')) return '☁️';
      if (conditionLower.includes('rain') && conditionLower.includes('thunder')) return '⛈️';
      if (conditionLower.includes('thunder')) return '⛈️';
      if (conditionLower.includes('rain')) return '🌧️';
      if (conditionLower.includes('drizzle')) return '🌦️';
      if (conditionLower.includes('snow')) return '❄️';
      if (conditionLower.includes('sleet') || conditionLower.includes('ice')) return '🌨️';
      if (conditionLower.includes('mist') || conditionLower.includes('fog')) return '🌫️';
      
      return '🌤️'; // Default
    }

    // Get weather background
    function getWeatherBackground(condition) {
      const conditionLower = condition.toLowerCase();
      
      if (conditionLower.includes('sunny') || conditionLower.includes('clear')) return 'from-yellow-400 to-orange-500';
      if (conditionLower.includes('partly cloudy')) return 'from-blue-300 to-blue-500';
      if (conditionLower.includes('cloudy') || conditionLower.includes('overcast')) return 'from-gray-400 to-gray-600';
      if (conditionLower.includes('thunder')) return 'from-gray-700 to-gray-900';
      if (conditionLower.includes('rain') || conditionLower.includes('drizzle')) return 'from-blue-500 to-blue-700';
      if (conditionLower.includes('snow') || conditionLower.includes('sleet') || conditionLower.includes('ice')) return 'from-blue-200 to-blue-400';
      if (conditionLower.includes('mist') || conditionLower.includes('fog')) return 'from-gray-300 to-gray-500';
      
      return 'from-blue-400 to-blue-600'; // Default
    }

    // Get country flag emoji
    function getCountryFlag(countryCode) {
      if (!countryCode) return '';
      const codePoints = countryCode
        .toUpperCase()
        .split('')
        .map(char => 127397 + char.charCodeAt());
      return String.fromCodePoint(...codePoints);
    }

    // Show loading state
    function showLoading() {
      weatherContent.classList.add('hidden');
      weatherLoading.classList.remove('hidden');
    }

    // Hide loading state
    function hideLoading() {
      weatherLoading.classList.add('hidden');
      weatherContent.classList.remove('hidden');
    }

    // Display weather data (WeatherAPI.com format)
    function displayWeather(data) {
      const { location, current } = data;
      const temp = Math.round(current.temp_c);
      const feelsLike = Math.round(current.feelslike_c);
      const condition = current.condition.text;
      const humidity = current.humidity;
      const windSpeed = Math.round(current.wind_kph);
      const country = location.country;
      const city = location.name;
      
      const icon = getWeatherIcon(condition);
      const background = getWeatherBackground(condition);
      const flag = getCountryFlag(location.country);
      
      // Update background
      weatherDisplay.className = `h-48 bg-gradient-to-br ${background} rounded-xl flex flex-col items-center justify-center text-white transition-all duration-500`;
      
      // Update content
      weatherContent.innerHTML = `
        <div class="text-5xl mb-3">${icon}</div>
        <div class="text-3xl font-bold mb-1">${temp}°C</div>
        <div class="text-sm opacity-90 mb-2">${condition}</div>
        <div class="text-sm opacity-90 mb-3">${city}, ${country} ${flag}</div>
        <div class="flex gap-4 text-xs opacity-80">
          <span>Feels like ${feelsLike}°C</span>
          <span>💧 ${humidity}%</span>
          <span>💨 ${windSpeed} km/h</span>
        </div>
      `;
      
      hideLoading();
    }

    // Display error
    function displayError(message) {
      weatherDisplay.className = 'h-48 bg-gradient-to-br from-red-400 to-red-600 rounded-xl flex flex-col items-center justify-center text-white transition-all duration-500';
      
      weatherContent.innerHTML = `
        <div class="text-4xl mb-3">❌</div>
        <div class="text-lg font-semibold mb-2">Error</div>
        <div class="text-sm opacity-90 text-center px-4">${message}</div>
      `;
      
      hideLoading();
    }

    // Fetch weather data (WeatherAPI.com)
    async function fetchWeather(city) {
      const apiKey = localStorage.getItem('weather_api_key');
      
      if (!apiKey) {
        displayError('Please add your WeatherAPI.com API key in settings');
        return;
      }
      
      if (!city.trim()) {
        displayError('Please enter a city name');
        return;
      }
      
      showLoading();
      
      try {
        const response = await fetch(
          `https://api.weatherapi.com/v1/current.json?key=${apiKey}&q=${encodeURIComponent(city)}&aqi=no`
        );
        
        if (!response.ok) {
          if (response.status === 401 || response.status === 403) {
            throw new Error('Invalid API key. Please check your settings.');
          } else if (response.status === 400) {
            throw new Error('City not found. Please check the spelling.');
          } else {
            throw new Error('Failed to fetch weather data. Please try again.');
          }
        }
        
        const data = await response.json();
        
        // Check if the response contains an error
        if (data.error) {
          throw new Error(data.error.message || 'Failed to fetch weather data');
        }
        
        displayWeather(data);
        
      } catch (error) {
        console.error('Weather fetch error:', error);
        displayError(error.message);
      }
    }

    // Event listeners
    if (weatherInfoBtn) {
      weatherInfoBtn.addEventListener('click', () => {
        weatherInfoModal.classList.remove('hidden');
      });
    }

    if (weatherSettingsBtn) {
      weatherSettingsBtn.addEventListener('click', () => {
        weatherSettingsModal.classList.remove('hidden');
      });
    }

    if (closeWeatherInfo) {
      closeWeatherInfo.addEventListener('click', () => {
        weatherInfoModal.classList.add('hidden');
      });
    }

    if (closeWeatherSettings) {
      closeWeatherSettings.addEventListener('click', () => {
        weatherSettingsModal.classList.add('hidden');
      });
    }

    // Modal click outside to close
    if (weatherInfoModal) {
      weatherInfoModal.addEventListener('click', (e) => {
        if (e.target === weatherInfoModal) {
          weatherInfoModal.classList.add('hidden');
        }
      });
    }

    if (weatherSettingsModal) {
      weatherSettingsModal.addEventListener('click', (e) => {
        if (e.target === weatherSettingsModal) {
          weatherSettingsModal.classList.add('hidden');
        }
      });
    }

    // Save weather settings
    if (saveWeatherSettings) {
      saveWeatherSettings.addEventListener('click', () => {
        const apiKey = weatherApiKeyInput.value.trim();
        if (apiKey) {
          localStorage.setItem('weather_api_key', apiKey);
          weatherSettingsModal.classList.add('hidden');
          showToast('Weather API key saved!', 'success');
        } else {
          alert('Please enter your OpenWeatherMap API key');
        }
      });
    }

    // Clear weather settings
    if (clearWeatherSettings) {
      clearWeatherSettings.addEventListener('click', () => {
        if (confirm('Are you sure you want to clear the API key?')) {
          localStorage.removeItem('weather_api_key');
          weatherApiKeyInput.value = '';
          weatherSettingsModal.classList.add('hidden');
          showToast('Weather API key cleared', 'success');
        }
      });
    }

    // Search weather
    if (searchWeather) {
      searchWeather.addEventListener('click', () => {
        fetchWeather(cityInput.value);
      });
    }

    // Enter key to search
    if (cityInput) {
      cityInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          fetchWeather(cityInput.value);
        }
      });
    }

    // Load weather settings on page load
    loadWeatherSettings();

    // ===== PYTHON CONSOLE =====
    const pythonInfoBtn = document.getElementById('pythonInfoBtn');
    const pythonInfoModal = document.getElementById('pythonInfoModal');
    const closePythonInfo = document.getElementById('closePythonInfo');
    const pythonConsole = document.getElementById('pythonConsole');
    const consoleOutput = document.getElementById('consoleOutput');
    const pythonInput = document.getElementById('pythonInput');
    const clearConsole = document.getElementById('clearConsole');
    const pythonLoading = document.getElementById('pythonLoading');

    let pyodide = null;
    let pyodideReady = false;
    let commandHistory = [];
    let historyIndex = -1;
    let multiLineBuffer = '';
    let isMultiLine = false;

    // Initialize Pyodide
    async function initPyodide() {
      if (pyodideReady) return;
      
      try {
        pythonLoading.classList.remove('hidden');
        
        pyodide = await loadPyodide();
        pyodideReady = true;
        
        pythonLoading.classList.add('hidden');
        
      } catch (error) {
        pythonLoading.classList.add('hidden');
        addToConsole(`Failed to load Python: ${error.message}`, 'error');
      }
    }

    // Add content to console
    function addToConsole(content, type = 'output') {
      const colors = {
        'output': 'text-green-400',
        'error': 'text-red-400',
        'input': 'text-white',
        'system': 'text-cyan-400'
      };
      
      const div = document.createElement('div');
      div.className = colors[type] || 'text-green-400';
      
      if (type === 'input') {
        div.innerHTML = `<span class="text-yellow-400">&gt;&gt;&gt;</span> ${content}`;
      } else if (type === 'continuation') {
        div.innerHTML = `<span class="text-yellow-400">...</span> ${content}`;
      } else {
        div.textContent = content;
      }
      
      consoleOutput.appendChild(div);
      pythonConsole.scrollTop = pythonConsole.scrollHeight;
    }

    // Execute Python code
    async function executePython(code) {
      if (!pyodideReady) {
        addToConsole('Python environment not ready. Please wait...', 'error');
        return;
      }

      try {
        // Capture stdout
        pyodide.runPython(`
import sys
from io import StringIO
sys.stdout = StringIO()
sys.stderr = StringIO()
        `);

        // Execute the code
        let result = pyodide.runPython(code);
        
        // Get stdout and stderr
        const stdout = pyodide.runPython('sys.stdout.getvalue()');
        const stderr = pyodide.runPython('sys.stderr.getvalue()');
        
        // Reset stdout/stderr
        pyodide.runPython(`
sys.stdout = sys.__stdout__
sys.stderr = sys.__stderr__
        `);

        // Display output
        if (stdout) {
          addToConsole(stdout.trimEnd(), 'output');
        }
        
        if (stderr) {
          addToConsole(stderr.trimEnd(), 'error');
        }
        
        // Display result if it's not None and no stdout
        if (result !== undefined && result !== null && !stdout) {
          addToConsole(String(result), 'output');
        }

      } catch (error) {
        // Format Python error
        let errorMsg = error.message;
        if (errorMsg.includes('Traceback')) {
          // Clean up the traceback for better display
          errorMsg = errorMsg.split('\n').slice(1).join('\n');
        }
        addToConsole(errorMsg, 'error');
      }
    }

    // Check if code needs continuation (incomplete)
    function needsContinuation(code) {
      // Simple heuristics for multi-line detection
      const trimmed = code.trim();
      if (trimmed.endsWith(':')) return true;
      if (trimmed.endsWith('\\')) return true;
      
      // Check for unclosed brackets/parentheses
      let brackets = 0;
      let parens = 0;
      let braces = 0;
      let inString = false;
      let stringChar = '';
      
      for (let i = 0; i < code.length; i++) {
        const char = code[i];
        const prevChar = i > 0 ? code[i-1] : '';
        
        if (!inString) {
          if (char === '"' || char === "'") {
            inString = true;
            stringChar = char;
          } else if (char === '[') brackets++;
          else if (char === ']') brackets--;
          else if (char === '(') parens++;
          else if (char === ')') parens--;
          else if (char === '{') braces++;
          else if (char === '}') braces--;
        } else {
          if (char === stringChar && prevChar !== '\\') {
            inString = false;
          }
        }
      }
      
      return brackets > 0 || parens > 0 || braces > 0 || inString;
    }

    // Handle input
    function handleInput() {
      const code = pythonInput.value;
      
      if (!code.trim() && !isMultiLine) return;
      
      // Add to history
      if (code.trim()) {
        commandHistory.unshift(code);
        if (commandHistory.length > 50) commandHistory.pop();
        historyIndex = -1;
      }
      
      if (isMultiLine) {
        addToConsole(code, 'continuation');
        multiLineBuffer += '\n' + code;
        
        // Check if we should execute or continue
        if (!code.trim() || !needsContinuation(multiLineBuffer)) {
          // Execute multi-line code
          executePython(multiLineBuffer);
          multiLineBuffer = '';
          isMultiLine = false;
        }
      } else {
        addToConsole(code, 'input');
        
        if (needsContinuation(code)) {
          // Start multi-line mode
          multiLineBuffer = code;
          isMultiLine = true;
        } else {
          // Execute single line
          executePython(code);
        }
      }
      
      pythonInput.value = '';
    }

    // Event listeners
    if (pythonInfoBtn) {
      pythonInfoBtn.addEventListener('click', () => {
        pythonInfoModal.classList.remove('hidden');
      });
    }

    if (closePythonInfo) {
      closePythonInfo.addEventListener('click', () => {
        pythonInfoModal.classList.add('hidden');
      });
    }

    if (pythonInfoModal) {
      pythonInfoModal.addEventListener('click', (e) => {
        if (e.target === pythonInfoModal) {
          pythonInfoModal.classList.add('hidden');
        }
      });
    }

    if (clearConsole) {
      clearConsole.addEventListener('click', () => {
        consoleOutput.innerHTML = '';
        multiLineBuffer = '';
        isMultiLine = false;
        addToConsole('Console cleared. Python environment ready.', 'system');
      });
    }

    if (pythonInput) {
      pythonInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          if (e.shiftKey) {
            // Shift+Enter: continue on new line (handled by default)
            return;
          } else {
            e.preventDefault();
            handleInput();
          }
        } else if (e.key === 'ArrowUp') {
          e.preventDefault();
          if (historyIndex < commandHistory.length - 1) {
            historyIndex++;
            pythonInput.value = commandHistory[historyIndex] || '';
          }
        } else if (e.key === 'ArrowDown') {
          e.preventDefault();
          if (historyIndex > -1) {
            historyIndex--;
            pythonInput.value = historyIndex === -1 ? '' : commandHistory[historyIndex];
          }
        }
      });

      // Focus input when console is clicked
      pythonConsole.addEventListener('click', () => {
        pythonInput.focus();
      });

      // Auto-focus on page load
      setTimeout(() => {
        pythonInput.focus();
      }, 1000);
    }

    // Initialize Python when the page loads
    setTimeout(() => {
      initPyodide();
    }, 1000);

    // ===== DRAWING CANVAS =====
    const canvasInfoBtn = document.getElementById('canvasInfoBtn');
    const canvasInfoModal = document.getElementById('canvasInfoModal');
    const closeCanvasInfo = document.getElementById('closeCanvasInfo');
    const drawingCanvas = document.getElementById('drawingCanvas');
    const colorPicker = document.getElementById('colorPicker');
    const drawTool = document.getElementById('drawTool');
    const eraserTool = document.getElementById('eraserTool');
    const brushSize = document.getElementById('brushSize');
    const downloadCanvas = document.getElementById('downloadCanvas');
    const clearCanvas = document.getElementById('clearCanvas');

    let ctx = null;
    let isDrawing = false;
    let currentTool = 'draw';
    let currentColor = '#000000';
    let currentSize = 3;

    // Initialize canvas
    function initCanvas() {
      if (!drawingCanvas) return;
      
      ctx = drawingCanvas.getContext('2d');
      
      // Set canvas size to match display size
      const rect = drawingCanvas.getBoundingClientRect();
      drawingCanvas.width = rect.width * 2; // High DPI
      drawingCanvas.height = rect.height * 2;
      ctx.scale(2, 2);
      
      // Set default styles
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      ctx.strokeStyle = currentColor;
      ctx.lineWidth = currentSize;
      
      // Fill with white background
      ctx.fillStyle = 'white';
      ctx.fillRect(0, 0, drawingCanvas.width, drawingCanvas.height);
    }

    // Get mouse/touch position
    function getCanvasPosition(e) {
      const rect = drawingCanvas.getBoundingClientRect();
      const clientX = e.clientX || (e.touches && e.touches[0].clientX);
      const clientY = e.clientY || (e.touches && e.touches[0].clientY);
      
      return {
        x: clientX - rect.left,
        y: clientY - rect.top
      };
    }

    // Start drawing
    function startDrawing(e) {
      e.preventDefault();
      isDrawing = true;
      
      const pos = getCanvasPosition(e);
      ctx.beginPath();
      ctx.moveTo(pos.x, pos.y);
    }

    // Draw
    function draw(e) {
      if (!isDrawing) return;
      e.preventDefault();
      
      const pos = getCanvasPosition(e);
      
      if (currentTool === 'draw') {
        ctx.globalCompositeOperation = 'source-over';
        ctx.strokeStyle = currentColor;
        ctx.lineWidth = currentSize;
      } else if (currentTool === 'erase') {
        ctx.globalCompositeOperation = 'destination-out';
        ctx.lineWidth = currentSize * 2; // Eraser is bigger
      }
      
      ctx.lineTo(pos.x, pos.y);
      ctx.stroke();
    }

    // Stop drawing
    function stopDrawing() {
      if (!isDrawing) return;
      isDrawing = false;
      ctx.beginPath();
    }

    // Update tool selection
    function updateToolSelection() {
      if (currentTool === 'draw') {
        drawTool.className = 'px-3 py-1 bg-blue-500 text-white rounded-full text-xs font-medium hover:bg-blue-600 transition-colors';
        eraserTool.className = 'px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full text-xs font-medium transition-colors';
        drawingCanvas.style.cursor = 'crosshair';
      } else {
        drawTool.className = 'px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-full text-xs font-medium transition-colors';
        eraserTool.className = 'px-3 py-1 bg-red-500 text-white rounded-full text-xs font-medium hover:bg-red-600 transition-colors';
        drawingCanvas.style.cursor = 'grab';
      }
    }

    // Event listeners
    if (canvasInfoBtn) {
      canvasInfoBtn.addEventListener('click', () => {
        canvasInfoModal.classList.remove('hidden');
      });
    }

    if (closeCanvasInfo) {
      closeCanvasInfo.addEventListener('click', () => {
        canvasInfoModal.classList.add('hidden');
      });
    }

    if (canvasInfoModal) {
      canvasInfoModal.addEventListener('click', (e) => {
        if (e.target === canvasInfoModal) {
          canvasInfoModal.classList.add('hidden');
        }
      });
    }

    // Canvas drawing events
    if (drawingCanvas) {
      // Mouse events
      drawingCanvas.addEventListener('mousedown', startDrawing);
      drawingCanvas.addEventListener('mousemove', draw);
      drawingCanvas.addEventListener('mouseup', stopDrawing);
      drawingCanvas.addEventListener('mouseout', stopDrawing);

      // Touch events
      drawingCanvas.addEventListener('touchstart', startDrawing);
      drawingCanvas.addEventListener('touchmove', draw);
      drawingCanvas.addEventListener('touchend', stopDrawing);
      drawingCanvas.addEventListener('touchcancel', stopDrawing);
    }

    // Tool controls
    if (colorPicker) {
      colorPicker.addEventListener('change', (e) => {
        currentColor = e.target.value;
        if (currentTool === 'draw') {
          ctx.strokeStyle = currentColor;
        }
      });
    }

    if (drawTool) {
      drawTool.addEventListener('click', () => {
        currentTool = 'draw';
        updateToolSelection();
      });
    }

    if (eraserTool) {
      eraserTool.addEventListener('click', () => {
        currentTool = 'erase';
        updateToolSelection();
      });
    }

    if (brushSize) {
      const sizeDisplay = document.getElementById('sizeDisplay');
      brushSize.addEventListener('input', (e) => {
        currentSize = parseInt(e.target.value);
        if (sizeDisplay) sizeDisplay.textContent = currentSize;
      });
    }

    if (downloadCanvas) {
      downloadCanvas.addEventListener('click', () => {
        // Create a temporary canvas with white background
        const tempCanvas = document.createElement('canvas');
        const tempCtx = tempCanvas.getContext('2d');
        tempCanvas.width = drawingCanvas.width;
        tempCanvas.height = drawingCanvas.height;
        
        // Fill with white background
        tempCtx.fillStyle = 'white';
        tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
        
        // Draw the original canvas on top
        tempCtx.drawImage(drawingCanvas, 0, 0);
        
        // Download
        const link = document.createElement('a');
        link.download = 'drawing.png';
        link.href = tempCanvas.toDataURL();
        link.click();
        
        showToast('Drawing downloaded!', 'success');
      });
    }

    if (clearCanvas) {
      clearCanvas.addEventListener('click', () => {
        if (confirm('Are you sure you want to clear the canvas?')) {
          ctx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
          ctx.fillStyle = 'white';
          ctx.fillRect(0, 0, drawingCanvas.width, drawingCanvas.height);
          showToast('Canvas cleared!', 'success');
        }
      });
    }

    // Initialize canvas when page loads
    setTimeout(() => {
      initCanvas();
      updateToolSelection();
    }, 500);

    // Handle window resize
    window.addEventListener('resize', () => {
      setTimeout(() => {
        if (drawingCanvas && ctx) {
          // Save current drawing
          const imageData = ctx.getImageData(0, 0, drawingCanvas.width, drawingCanvas.height);
          initCanvas();
          // Restore drawing
          ctx.putImageData(imageData, 0, 0);
        }
      }, 100);
    });

    // ===== DATA VISUALIZATION PLAYGROUND =====
    const vizInfoBtn = document.getElementById('vizInfoBtn');
    const vizInfoModal = document.getElementById('vizInfoModal');
    const closeVizInfo = document.getElementById('closeVizInfo');
    const sampleDataset = document.getElementById('sampleDataset');
    const csvDropZone = document.getElementById('csvDropZone');
    const csvFileInput = document.getElementById('csvFileInput');
    const dataPreview = document.getElementById('dataPreview');
    const chartType = document.getElementById('chartType');
    const xAxisColumn = document.getElementById('xAxisColumn');
    const yAxisColumn = document.getElementById('yAxisColumn');
    const updateChart = document.getElementById('updateChart');
    const resetViz = document.getElementById('resetViz');
    const downloadChart = document.getElementById('downloadChart');
    const downloadData = document.getElementById('downloadData');
    const dataChart = document.getElementById('dataChart');
    const chartPlaceholder = document.getElementById('chartPlaceholder');

    let currentData = null;
    let currentChart = null;
    let chartColumns = [];

    // Sample datasets
    const sampleDatasets = {
      sales: [
        { Month: 'Jan', Revenue: 45000, Expenses: 32000, Profit: 13000 },
        { Month: 'Feb', Revenue: 52000, Expenses: 35000, Profit: 17000 },
        { Month: 'Mar', Revenue: 48000, Expenses: 33000, Profit: 15000 },
        { Month: 'Apr', Revenue: 61000, Expenses: 38000, Profit: 23000 },
        { Month: 'May', Revenue: 55000, Expenses: 36000, Profit: 19000 },
        { Month: 'Jun', Revenue: 67000, Expenses: 41000, Profit: 26000 }
      ],
      population: [
        { Country: 'China', Population: 1439323776, Area: 9596960 },
        { Country: 'India', Population: 1380004385, Area: 3287263 },
        { Country: 'USA', Population: 331002651, Area: 9833517 },
        { Country: 'Indonesia', Population: 273523615, Area: 1904569 },
        { Country: 'Pakistan', Population: 220892340, Area: 881913 },
        { Country: 'Brazil', Population: 212559417, Area: 8514877 }
      ],
      traffic: [
        { Date: '2024-01-01', Visitors: 1250, PageViews: 3200, BounceRate: 0.35 },
        { Date: '2024-01-02', Visitors: 1180, PageViews: 2950, BounceRate: 0.42 },
        { Date: '2024-01-03', Visitors: 1420, PageViews: 3800, BounceRate: 0.28 },
        { Date: '2024-01-04', Visitors: 1350, PageViews: 3500, BounceRate: 0.31 },
        { Date: '2024-01-05', Visitors: 1580, PageViews: 4200, BounceRate: 0.25 },
        { Date: '2024-01-06', Visitors: 1680, PageViews: 4500, BounceRate: 0.22 },
        { Date: '2024-01-07', Visitors: 1450, PageViews: 3750, BounceRate: 0.29 }
      ]
    };

    // Initialize data visualization
    function initDataViz() {
      // Don't auto-load data, let user choose
      updateDataPreview();
      updateColumnSelectors();
    }

    // Load sample data
    function loadSampleData(datasetName) {
      currentData = sampleDatasets[datasetName];
      if (currentData && currentData.length > 0) {
        chartColumns = Object.keys(currentData[0]);
        updateDataPreview();
        updateColumnSelectors();
        showToast(`Loaded ${datasetName} dataset`, 'success');
      }
    }

    // Update data preview table
    function updateDataPreview() {
      if (!currentData || currentData.length === 0) {
        dataPreview.innerHTML = '<div class="text-gray-500 text-center py-2">No data available</div>';
        return;
      }

      const headers = Object.keys(currentData[0]);
      let html = '<table class="w-full text-xs"><thead><tr>';
      
      headers.forEach(header => {
        html += `<th class="text-left font-medium text-gray-700 p-1 border-b">${header}</th>`;
      });
      html += '</tr></thead><tbody>';

      // Show first 3 rows
      currentData.slice(0, 3).forEach(row => {
        html += '<tr>';
        headers.forEach(header => {
          let value = row[header];
          if (typeof value === 'number') {
            value = value.toLocaleString();
          }
          html += `<td class="p-1 border-b text-gray-600">${value}</td>`;
        });
        html += '</tr>';
      });

      if (currentData.length > 3) {
        html += `<tr><td colspan="${headers.length}" class="text-center text-gray-500 p-1">... and ${currentData.length - 3} more rows</td></tr>`;
      }

      html += '</tbody></table>';
      dataPreview.innerHTML = html;
    }

    // Update column selector dropdowns
    function updateColumnSelectors() {
      if (!chartColumns.length) return;

      // Clear existing options
      xAxisColumn.innerHTML = '<option value="">Select column...</option>';
      yAxisColumn.innerHTML = '<option value="">Select column...</option>';

      // Add column options
      chartColumns.forEach(column => {
        xAxisColumn.innerHTML += `<option value="${column}">${column}</option>`;
        yAxisColumn.innerHTML += `<option value="${column}">${column}</option>`;
      });

      // Set default selections
      if (chartColumns.length >= 2) {
        xAxisColumn.value = chartColumns[0];
        yAxisColumn.value = chartColumns[1];
      }
    }

    // Parse CSV file
    function parseCSV(file) {
      Papa.parse(file, {
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          if (results.errors.length > 0) {
            showToast('Error parsing CSV file', 'error');
            console.error('CSV parse errors:', results.errors);
            return;
          }

          if (results.data.length === 0) {
            showToast('CSV file is empty', 'error');
            return;
          }

          currentData = results.data;
          chartColumns = Object.keys(currentData[0]);
          updateDataPreview();
          updateColumnSelectors();
          showToast('CSV file loaded successfully', 'success');
        },
        error: function(error) {
          showToast('Failed to parse CSV file', 'error');
          console.error('CSV parse error:', error);
        }
      });
    }

    // Create chart
    function createChart() {
      const xCol = xAxisColumn.value;
      const yCol = yAxisColumn.value;
      const type = chartType.value;

      if (!currentData || !xCol || !yCol) {
        showToast('Please select data and columns', 'error');
        return;
      }

      // Destroy existing chart
      if (currentChart) {
        currentChart.destroy();
      }

      // Hide placeholder, show canvas
      chartPlaceholder.style.display = 'none';
      dataChart.style.display = 'block';

      // Prepare data
      const labels = currentData.map(row => row[xCol]);
      const data = currentData.map(row => {
        const value = row[yCol];
        return typeof value === 'string' ? parseFloat(value) || 0 : value;
      });

      // Chart configuration
      const config = {
        type: type === 'area' ? 'line' : type,
        data: {
          labels: labels,
          datasets: [{
            label: yCol,
            data: data,
            backgroundColor: type === 'pie' ? [
              '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'
            ] : type === 'area' ? 'rgba(54, 162, 235, 0.2)' : 'rgba(54, 162, 235, 0.8)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: type === 'line' || type === 'area' ? 2 : 1,
            fill: type === 'area',
            tension: type === 'line' || type === 'area' ? 0.4 : 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: type === 'pie',
              position: 'bottom'
            },
            tooltip: {
              mode: 'index',
              intersect: false,
            }
          },
          scales: type === 'pie' ? {} : {
            x: {
              display: true,
              title: {
                display: true,
                text: xCol
              }
            },
            y: {
              display: true,
              title: {
                display: true,
                text: yCol
              }
            }
          },
          interaction: {
            mode: 'nearest',
            axis: 'x',
            intersect: false
          }
        }
      };

      // Create chart
      currentChart = new Chart(dataChart, config);
      showToast('Chart updated successfully', 'success');
    }

    // Export chart as PNG
    function exportChart() {
      if (!currentChart) {
        showToast('No chart to export', 'error');
        return;
      }

      const link = document.createElement('a');
      link.download = 'chart.png';
      link.href = currentChart.toBase64Image();
      link.click();
      showToast('Chart downloaded', 'success');
    }

    // Export data as CSV
    function exportData() {
      if (!currentData) {
        showToast('No data to export', 'error');
        return;
      }

      const csv = Papa.unparse(currentData);
      const blob = new Blob([csv], { type: 'text/csv' });
      const link = document.createElement('a');
      link.download = 'data.csv';
      link.href = URL.createObjectURL(blob);
      link.click();
      showToast('Data downloaded', 'success');
    }

    // Reset visualization
    function resetVisualization() {
      if (currentChart) {
        currentChart.destroy();
        currentChart = null;
      }
      dataChart.style.display = 'none';
      chartPlaceholder.style.display = 'flex';
      
      // Reset to default dataset
      sampleDataset.value = 'sales';
      loadSampleData('sales');
      showToast('Visualization reset', 'success');
    }

    // Event listeners
    if (vizInfoBtn) {
      vizInfoBtn.addEventListener('click', () => {
        vizInfoModal.classList.remove('hidden');
      });
    }

    if (closeVizInfo) {
      closeVizInfo.addEventListener('click', () => {
        vizInfoModal.classList.add('hidden');
      });
    }

    if (vizInfoModal) {
      vizInfoModal.addEventListener('click', (e) => {
        if (e.target === vizInfoModal) {
          vizInfoModal.classList.add('hidden');
        }
      });
    }

    if (sampleDataset) {
      sampleDataset.addEventListener('change', (e) => {
        loadSampleData(e.target.value);
      });
    }

    if (csvDropZone) {
      csvDropZone.addEventListener('click', () => {
        csvFileInput.click();
      });

      csvDropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        csvDropZone.classList.add('border-blue-400', 'bg-blue-50');
      });

      csvDropZone.addEventListener('dragleave', () => {
        csvDropZone.classList.remove('border-blue-400', 'bg-blue-50');
      });

      csvDropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        csvDropZone.classList.remove('border-blue-400', 'bg-blue-50');
        
        const files = e.dataTransfer.files;
        if (files.length > 0 && files[0].type === 'text/csv') {
          parseCSV(files[0]);
        } else {
          showToast('Please drop a CSV file', 'error');
        }
      });
    }

    if (csvFileInput) {
      csvFileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file && file.type === 'text/csv') {
          parseCSV(file);
        } else {
          showToast('Please select a CSV file', 'error');
        }
      });
    }

    if (updateChart) {
      updateChart.addEventListener('click', createChart);
    }

    if (resetViz) {
      resetViz.addEventListener('click', resetVisualization);
    }

    if (downloadChart) {
      downloadChart.addEventListener('click', exportChart);
    }

    if (downloadData) {
      downloadData.addEventListener('click', exportData);
    }

    // Initialize data visualization
    setTimeout(() => {
      initDataViz();
    }, 500);

    // ===== TREE GROWTH SIMULATION =====
    const aiInfoBtn = document.getElementById('aiInfoBtn');
    const aiInfoModal = document.getElementById('aiInfoModal');
    const closeAiInfo = document.getElementById('closeAiInfo');
    const aiSettingsBtn = document.getElementById('aiSettingsBtn');
    const aiSettingsModal = document.getElementById('aiSettingsModal');
    const closeAiSettings = document.getElementById('closeAiSettings');
    const imagePrompt = document.getElementById('imagePrompt');
    const imageStyle = document.getElementById('imageStyle');
    const imageSize = document.getElementById('imageSize');
    const numImages = document.getElementById('numImages');
    const generateBtn = document.getElementById('generateBtn');
    const aiLoading = document.getElementById('aiLoading');
    const imageGrid = document.getElementById('imageGrid');
    const imagePlaceholder = document.getElementById('imagePlaceholder');
    const demoImages = document.getElementById('demoImages');
    const downloadAll = document.getElementById('downloadAll');
    const clearGallery = document.getElementById('clearGallery');

    // Settings elements
    const aiModel = document.getElementById('aiModel');
    const guidanceScale = document.getElementById('guidanceScale');
    const guidanceValue = document.getElementById('guidanceValue');
    const inferenceSteps = document.getElementById('inferenceSteps');
    const stepsValue = document.getElementById('stepsValue');
    const randomSeed = document.getElementById('randomSeed');
    const randomizeSeed = document.getElementById('randomizeSeed');
    const negativePrompt = document.getElementById('negativePrompt');
    const saveAiSettings = document.getElementById('saveAiSettings');
    const resetAiSettings = document.getElementById('resetAiSettings');

    let generatedImages = [];
    let aiSettings = {
      model: 'stabilityai/stable-diffusion-2-1',
      guidance_scale: 7.5,
      num_inference_steps: 20,
      seed: null,
      negative_prompt: ''
    };

    // Initialize AI Image Generator
    function initAiGenerator() {
      loadAiSettings();
      updateSettingsDisplay();
    }

    // Load AI settings from localStorage
    function loadAiSettings() {
      const saved = localStorage.getItem('aiSettings');
      if (saved) {
        aiSettings = { ...aiSettings, ...JSON.parse(saved) };
      }
    }

    // Save AI settings to localStorage
    function saveAiSettingsToStorage() {
      localStorage.setItem('aiSettings', JSON.stringify(aiSettings));
    }

    // Update settings display
    function updateSettingsDisplay() {
      if (aiModel) aiModel.value = aiSettings.model;
      if (guidanceScale) {
        guidanceScale.value = aiSettings.guidance_scale;
        guidanceValue.textContent = aiSettings.guidance_scale;
      }
      if (inferenceSteps) {
        inferenceSteps.value = aiSettings.num_inference_steps;
        stepsValue.textContent = aiSettings.num_inference_steps;
      }
      if (randomSeed) randomSeed.value = aiSettings.seed || '';
      if (negativePrompt) negativePrompt.value = aiSettings.negative_prompt;
    }

    // Generate images using Hugging Face API (simulated for demo)
    async function generateImages() {
      const prompt = imagePrompt.value.trim();
      if (!prompt) {
        showToast('Please enter a prompt', 'error');
        return;
      }

      // Show loading state
      generateBtn.disabled = true;
      aiLoading.classList.remove('hidden');
      
      try {
        // Hide demo images, show real grid
        demoImages.style.display = 'none';
        imagePlaceholder.style.display = 'none';
        
        const style = imageStyle.value;
        const size = imageSize.value;
        const count = parseInt(numImages.value);
        
        // Build full prompt with style
        let fullPrompt = prompt;
        if (style) {
          fullPrompt += `, ${style} style`;
        }
        
        // Simulate API call delay
        await new Promise(resolve => setTimeout(resolve, 2000 + Math.random() * 3000));
        
        // Generate placeholder images (in real implementation, this would call Hugging Face API)
        const newImages = [];
        for (let i = 0; i < count; i++) {
          const imageData = {
            id: Date.now() + i,
            prompt: fullPrompt,
            url: generatePlaceholderImage(fullPrompt, size),
            timestamp: new Date().toLocaleString(),
            settings: { ...aiSettings }
          };
          newImages.push(imageData);
        }
        
        // Add to generated images
        generatedImages.unshift(...newImages);
        
        // Keep only last 20 images
        if (generatedImages.length > 20) {
          generatedImages = generatedImages.slice(0, 20);
        }
        
        // Update gallery
        updateImageGallery();
        
        showToast(`Generated ${count} image${count > 1 ? 's' : ''} successfully!`, 'success');
        
      } catch (error) {
        showToast('Failed to generate images. Please try again.', 'error');
        console.error('Image generation error:', error);
      } finally {
        generateBtn.disabled = false;
        aiLoading.classList.add('hidden');
      }
    }

    // Generate placeholder image (in real implementation, this would be the actual generated image)
    function generatePlaceholderImage(prompt, size) {
      const [width, height] = size.split('x').map(Number);
      const canvas = document.createElement('canvas');
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext('2d');
      
      // Create gradient background
      const gradient = ctx.createLinearGradient(0, 0, width, height);
      const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe'];
      const color1 = colors[Math.floor(Math.random() * colors.length)];
      const color2 = colors[Math.floor(Math.random() * colors.length)];
      gradient.addColorStop(0, color1);
      gradient.addColorStop(1, color2);
      
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, width, height);
      
      // Add some visual elements
      ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
      for (let i = 0; i < 10; i++) {
        const x = Math.random() * width;
        const y = Math.random() * height;
        const radius = Math.random() * 50 + 10;
        ctx.beginPath();
        ctx.arc(x, y, radius, 0, Math.PI * 2);
        ctx.fill();
      }
      
      // Add text
      ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
      ctx.font = '16px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('AI Generated', width / 2, height / 2 - 10);
      ctx.font = '12px Arial';
      ctx.fillText(prompt.substring(0, 30) + '...', width / 2, height / 2 + 10);
      
      return canvas.toDataURL();
    }

    // Update image gallery
    function updateImageGallery() {
      if (generatedImages.length === 0) {
        imagePlaceholder.style.display = 'block';
        downloadAll.classList.add('hidden');
        clearGallery.classList.add('hidden');
        return;
      }
      
      imagePlaceholder.style.display = 'none';
      downloadAll.classList.remove('hidden');
      clearGallery.classList.remove('hidden');
      
      imageGrid.innerHTML = '';
      
      generatedImages.forEach((image, index) => {
        const imageCard = document.createElement('div');
        imageCard.className = 'relative group cursor-pointer rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-shadow';
        
        imageCard.innerHTML = `
          <img src="${image.url}" alt="${image.prompt}" class="w-full h-32 object-cover">
          <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-opacity flex items-center justify-center">
            <div class="opacity-0 group-hover:opacity-100 transition-opacity flex gap-2">
              <button class="download-single px-2 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600" data-index="${index}">
                <i class="fa-solid fa-download"></i>
              </button>
              <button class="view-full px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600" data-index="${index}">
                <i class="fa-solid fa-expand"></i>
              </button>
            </div>
          </div>
          <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-2">
            <p class="text-white text-xs truncate">${image.prompt}</p>
            <p class="text-gray-300 text-xs">${image.timestamp}</p>
          </div>
        `;
        
        imageGrid.appendChild(imageCard);
      });
      
      // Add event listeners for download and view buttons
      document.querySelectorAll('.download-single').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const index = parseInt(btn.dataset.index);
          downloadImage(generatedImages[index]);
        });
      });
      
      document.querySelectorAll('.view-full').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const index = parseInt(btn.dataset.index);
          viewImageFullscreen(generatedImages[index]);
        });
      });
    }

    // Download single image
    function downloadImage(imageData) {
      const link = document.createElement('a');
      link.download = `ai-image-${imageData.id}.png`;
      link.href = imageData.url;
      link.click();
      showToast('Image downloaded!', 'success');
    }

    // View image fullscreen
    function viewImageFullscreen(imageData) {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4';
      modal.innerHTML = `
        <div class="max-w-4xl max-h-full flex flex-col">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-white text-lg font-medium">${imageData.prompt}</h3>
            <button class="close-fullscreen text-white hover:text-gray-300">
              <i class="fa-solid fa-xmark text-2xl"></i>
            </button>
          </div>
          <img src="${imageData.url}" alt="${imageData.prompt}" class="max-w-full max-h-full object-contain rounded-lg">
          <div class="flex gap-2 mt-4 justify-center">
            <button class="download-fullscreen px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">
              <i class="fa-solid fa-download mr-2"></i>Download
            </button>
            <button class="copy-prompt px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
              <i class="fa-solid fa-copy mr-2"></i>Copy Prompt
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      // Event listeners
      modal.querySelector('.close-fullscreen').addEventListener('click', () => {
        document.body.removeChild(modal);
      });
      
      modal.querySelector('.download-fullscreen').addEventListener('click', () => {
        downloadImage(imageData);
      });
      
      modal.querySelector('.copy-prompt').addEventListener('click', () => {
        navigator.clipboard.writeText(imageData.prompt);
        showToast('Prompt copied to clipboard!', 'success');
      });
      
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          document.body.removeChild(modal);
        }
      });
    }

    // Download all images
    function downloadAllImages() {
      if (generatedImages.length === 0) return;
      
      generatedImages.forEach((image, index) => {
        setTimeout(() => {
          downloadImage(image);
        }, index * 100);
      });
      
      showToast(`Downloading ${generatedImages.length} images...`, 'success');
    }

    // Clear gallery
    function clearImageGallery() {
      if (confirm('Are you sure you want to clear all generated images?')) {
        generatedImages = [];
        updateImageGallery();
        demoImages.style.display = 'grid';
        showToast('Gallery cleared!', 'success');
      }
    }

    // Event listeners
    if (aiInfoBtn) {
      aiInfoBtn.addEventListener('click', () => {
        aiInfoModal.classList.remove('hidden');
      });
    }

    if (closeAiInfo) {
      closeAiInfo.addEventListener('click', () => {
        aiInfoModal.classList.add('hidden');
      });
    }

    if (aiInfoModal) {
      aiInfoModal.addEventListener('click', (e) => {
        if (e.target === aiInfoModal) {
          aiInfoModal.classList.add('hidden');
        }
      });
    }

    if (aiSettingsBtn) {
      aiSettingsBtn.addEventListener('click', () => {
        aiSettingsModal.classList.remove('hidden');
      });
    }

    if (closeAiSettings) {
      closeAiSettings.addEventListener('click', () => {
        aiSettingsModal.classList.add('hidden');
      });
    }

    if (aiSettingsModal) {
      aiSettingsModal.addEventListener('click', (e) => {
        if (e.target === aiSettingsModal) {
          aiSettingsModal.classList.add('hidden');
        }
      });
    }

    // Sample prompt buttons
    document.querySelectorAll('.sample-prompt').forEach(btn => {
      btn.addEventListener('click', () => {
        imagePrompt.value = btn.dataset.prompt;
        showToast('Prompt filled! Click Generate to create images.', 'success');
      });
    });

    // Demo image cards
    document.querySelectorAll('.demo-image-card').forEach(card => {
      card.addEventListener('click', () => {
        const prompts = [
          'A beautiful sunset over mountains',
          'A cute cat sitting in a garden',
          'Futuristic city with flying cars',
          'Abstract colorful art painting'
        ];
        const randomPrompt = prompts[Math.floor(Math.random() * prompts.length)];
        imagePrompt.value = randomPrompt;
        showToast('Try this sample prompt!', 'success');
      });
    });

    if (generateBtn) {
      generateBtn.addEventListener('click', generateImages);
    }

    if (downloadAll) {
      downloadAll.addEventListener('click', downloadAllImages);
    }

    if (clearGallery) {
      clearGallery.addEventListener('click', clearImageGallery);
    }

    // Settings event listeners
    if (guidanceScale) {
      guidanceScale.addEventListener('input', (e) => {
        guidanceValue.textContent = e.target.value;
        aiSettings.guidance_scale = parseFloat(e.target.value);
      });
    }

    if (inferenceSteps) {
      inferenceSteps.addEventListener('input', (e) => {
        stepsValue.textContent = e.target.value;
        aiSettings.num_inference_steps = parseInt(e.target.value);
      });
    }

    if (randomizeSeed) {
      randomizeSeed.addEventListener('click', () => {
        const seed = Math.floor(Math.random() * 1000000);
        randomSeed.value = seed;
        aiSettings.seed = seed;
      });
    }

    if (saveAiSettings) {
      saveAiSettings.addEventListener('click', () => {
        aiSettings.model = aiModel.value;
        aiSettings.guidance_scale = parseFloat(guidanceScale.value);
        aiSettings.num_inference_steps = parseInt(inferenceSteps.value);
        aiSettings.seed = randomSeed.value ? parseInt(randomSeed.value) : null;
        aiSettings.negative_prompt = negativePrompt.value;
        
        saveAiSettingsToStorage();
        aiSettingsModal.classList.add('hidden');
        showToast('Settings saved!', 'success');
      });
    }

    if (resetAiSettings) {
      resetAiSettings.addEventListener('click', () => {
        aiSettings = {
          model: 'stabilityai/stable-diffusion-2-1',
          guidance_scale: 7.5,
          num_inference_steps: 20,
          seed: null,
          negative_prompt: ''
        };
        updateSettingsDisplay();
        showToast('Settings reset to defaults!', 'success');
      });
    }


    // ===== TYPING SPEED TEST =====
    const typingInfoBtn = document.getElementById('typingInfoBtn');
    const typingInfoModal = document.getElementById('typingInfoModal');
    const closeTypingInfo = document.getElementById('closeTypingInfo');
    const testDuration = document.getElementById('testDuration');
    const startTest = document.getElementById('startTest');
    const pauseTest = document.getElementById('pauseTest');
    const restartTest = document.getElementById('restartTest');
    const wpmDisplay = document.getElementById('wpmDisplay');
    const accuracyDisplay = document.getElementById('accuracyDisplay');
    const timeDisplay = document.getElementById('timeDisplay');
    const textDisplay = document.getElementById('textDisplay');
    const typingInput = document.getElementById('typingInput');
    const progressBar = document.getElementById('progressBar');
    const resultsPanel = document.getElementById('resultsPanel');
    const finalWPM = document.getElementById('finalWPM');
    const finalAccuracy = document.getElementById('finalAccuracy');
    const totalMistakes = document.getElementById('totalMistakes');
    const finalCPM = document.getElementById('finalCPM');
    const newTest = document.getElementById('newTest');

    let typingTestState = {
      isActive: false,
      isPaused: false,
      startTime: null,
      duration: 60,
      currentText: '',
      typedText: '',
      mistakes: 0,
      correctChars: 0,
      timer: null,
      timeLeft: 60
    };

    // Sample texts for typing test
    const sampleTexts = [
      "The quick brown fox jumps over the lazy dog. This pangram contains every letter of the alphabet and is commonly used for typing practice. It helps improve finger dexterity and keyboard familiarity while maintaining a steady rhythm.",
      
      "In a world where technology advances at lightning speed, the ability to type efficiently has become more important than ever. Whether you're writing emails, coding programs, or creating documents, fast and accurate typing can significantly boost your productivity.",
      
      "Practice makes perfect when it comes to developing typing skills. Regular exercise with proper finger placement on the home row keys will gradually increase your speed and accuracy. Remember to maintain good posture and take breaks to avoid strain.",
      
      "The art of touch typing involves muscle memory and coordination between your brain and fingers. As you practice consistently, your fingers will learn to find the right keys automatically without looking at the keyboard, leading to faster and more efficient typing.",
      
      "Typing speed is measured in words per minute, where a standard word is considered to be five characters including spaces. Professional typists can achieve speeds of over 80 WPM with high accuracy, while the average person types around 40 WPM."
    ];

    // Initialize typing test
    function initTypingTest() {
      resetTypingTest();
      loadRandomText();
    }

    // Load random text for typing
    function loadRandomText() {
      const randomIndex = Math.floor(Math.random() * sampleTexts.length);
      typingTestState.currentText = sampleTexts[randomIndex];
      displayText();
    }

    // Display text with highlighting
    function displayText() {
      const text = typingTestState.currentText;
      const typed = typingTestState.typedText;
      let html = '';

      for (let i = 0; i < text.length; i++) {
        const char = text[i];
        
        if (i < typed.length) {
          if (typed[i] === char) {
            html += `<span class="bg-green-200 text-green-800">${char}</span>`;
          } else {
            html += `<span class="bg-red-200 text-red-800">${char}</span>`;
          }
        } else if (i === typed.length) {
          html += `<span class="bg-blue-200 text-blue-800 animate-pulse">${char}</span>`;
        } else {
          html += `<span class="text-gray-700">${char}</span>`;
        }
      }

      textDisplay.innerHTML = html;
    }

    // Start typing test
    function startTypingTest() {
      if (typingTestState.isPaused) {
        // Resume test
        typingTestState.isPaused = false;
        startTimer();
      } else {
        // Start new test
        typingTestState.isActive = true;
        typingTestState.startTime = Date.now();
        typingTestState.duration = parseInt(testDuration.value);
        typingTestState.timeLeft = typingTestState.duration;
        
        typingInput.disabled = false;
        typingInput.focus();
        startTimer();
        loadRandomText();
      }

      startTest.classList.add('hidden');
      pauseTest.classList.remove('hidden');
      resultsPanel.classList.add('hidden');
    }

    // Pause typing test
    function pauseTypingTest() {
      typingTestState.isPaused = true;
      clearInterval(typingTestState.timer);
      
      startTest.classList.remove('hidden');
      pauseTest.classList.add('hidden');
      typingInput.disabled = true;
    }

    // Restart typing test
    function restartTypingTest() {
      resetTypingTest();
      loadRandomText();
      showToast('Test reset! Click Start to begin.', 'success');
    }

    // Reset typing test
    function resetTypingTest() {
      typingTestState.isActive = false;
      typingTestState.isPaused = false;
      typingTestState.startTime = null;
      typingTestState.typedText = '';
      typingTestState.mistakes = 0;
      typingTestState.correctChars = 0;
      typingTestState.timeLeft = parseInt(testDuration.value);
      
      clearInterval(typingTestState.timer);
      
      typingInput.value = '';
      typingInput.disabled = true;
      
      startTest.classList.remove('hidden');
      pauseTest.classList.add('hidden');
      resultsPanel.classList.add('hidden');
      
      updateMetrics();
      progressBar.style.width = '0%';
      
      textDisplay.innerHTML = '<span class="text-gray-400">Click Start to begin the typing test...</span>';
    }

    // Start timer
    function startTimer() {
      typingTestState.timer = setInterval(() => {
        typingTestState.timeLeft--;
        updateMetrics();
        
        if (typingTestState.timeLeft <= 0) {
          endTypingTest();
        }
      }, 1000);
    }

    // End typing test
    function endTypingTest() {
      typingTestState.isActive = false;
      clearInterval(typingTestState.timer);
      
      typingInput.disabled = true;
      startTest.classList.remove('hidden');
      pauseTest.classList.add('hidden');
      
      showResults();
      showToast('Test completed!', 'success');
    }

    // Update live metrics
    function updateMetrics() {
      if (!typingTestState.isActive && !typingTestState.isPaused) {
        wpmDisplay.textContent = '0';
        accuracyDisplay.textContent = '100%';
        timeDisplay.textContent = typingTestState.timeLeft;
        return;
      }

      const timeElapsed = typingTestState.duration - typingTestState.timeLeft;
      const totalChars = typingTestState.typedText.length;
      const correctChars = typingTestState.correctChars;
      
      // Calculate WPM (standard: 5 characters = 1 word)
      const wpm = timeElapsed > 0 ? Math.round((correctChars / 5) / (timeElapsed / 60)) : 0;
      
      // Calculate accuracy
      const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;
      
      // Update progress
      const progress = Math.min((typingTestState.typedText.length / typingTestState.currentText.length) * 100, 100);
      
      wpmDisplay.textContent = wpm;
      accuracyDisplay.textContent = accuracy + '%';
      timeDisplay.textContent = typingTestState.timeLeft;
      progressBar.style.width = progress + '%';
    }

    // Show final results
    function showResults() {
      const timeElapsed = typingTestState.duration - typingTestState.timeLeft;
      const totalChars = typingTestState.typedText.length;
      const correctChars = typingTestState.correctChars;
      
      const wpm = timeElapsed > 0 ? Math.round((correctChars / 5) / (timeElapsed / 60)) : 0;
      const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;
      const cpm = timeElapsed > 0 ? Math.round(correctChars / (timeElapsed / 60)) : 0;
      
      finalWPM.textContent = wpm;
      finalAccuracy.textContent = accuracy + '%';
      totalMistakes.textContent = typingTestState.mistakes;
      finalCPM.textContent = cpm;
      
      // Update performance dashboard with new results
      updatePerformanceDashboard(wpm, accuracy);
      
      resultsPanel.classList.remove('hidden');
    }

    // ===== PERFORMANCE DASHBOARD =====
    let performanceStats = {
      tests: [],
      totalTests: 0,
      bestWPM: 0,
      avgWPM: 0,
      avgAccuracy: 0,
      consistency: 0,
      speedProgress: 0
    };

    // Load performance stats from localStorage
    function loadPerformanceStats() {
      const saved = localStorage.getItem('typingPerformanceStats');
      if (saved) {
        performanceStats = JSON.parse(saved);
      }
      updatePerformanceDashboard();
    }

    // Save performance stats to localStorage
    function savePerformanceStats() {
      localStorage.setItem('typingPerformanceStats', JSON.stringify(performanceStats));
    }

    // Update performance dashboard with new test results
    function updatePerformanceDashboard(wpm = null, accuracy = null) {
      // If new results provided, add to stats
      if (wpm !== null && accuracy !== null) {
        const testResult = {
          wpm: wpm,
          accuracy: accuracy,
          date: new Date().toISOString(),
          timestamp: Date.now()
        };
        
        performanceStats.tests.push(testResult);
        performanceStats.totalTests++;
        
        // Keep only last 50 tests for performance
        if (performanceStats.tests.length > 50) {
          performanceStats.tests = performanceStats.tests.slice(-50);
        }
        
        // Calculate statistics
        calculatePerformanceStats();
        savePerformanceStats();
      }
      
      // Update dashboard display
      updateDashboardDisplay();
    }

    // Calculate performance statistics
    function calculatePerformanceStats() {
      if (performanceStats.tests.length === 0) return;
      
      const tests = performanceStats.tests;
      
      // Best WPM
      performanceStats.bestWPM = Math.max(...tests.map(t => t.wpm));
      
      // Average WPM
      performanceStats.avgWPM = Math.round(
        tests.reduce((sum, t) => sum + t.wpm, 0) / tests.length
      );
      
      // Average Accuracy
      performanceStats.avgAccuracy = Math.round(
        tests.reduce((sum, t) => sum + t.accuracy, 0) / tests.length
      );
      
      // Consistency (based on WPM variance - lower variance = higher consistency)
      const avgWPM = performanceStats.avgWPM;
      const variance = tests.reduce((sum, t) => sum + Math.pow(t.wpm - avgWPM, 2), 0) / tests.length;
      const standardDeviation = Math.sqrt(variance);
      performanceStats.consistency = Math.max(0, Math.round(100 - (standardDeviation * 2)));
      
      // Speed Progress (improvement over time)
      if (tests.length >= 5) {
        const recent = tests.slice(-5);
        const older = tests.slice(-10, -5);
        if (older.length > 0) {
          const recentAvg = recent.reduce((sum, t) => sum + t.wpm, 0) / recent.length;
          const olderAvg = older.reduce((sum, t) => sum + t.wpm, 0) / older.length;
          const improvement = ((recentAvg - olderAvg) / olderAvg) * 100;
          performanceStats.speedProgress = Math.max(0, Math.min(100, Math.round(50 + improvement)));
        } else {
          performanceStats.speedProgress = 50;
        }
      } else {
        performanceStats.speedProgress = 50;
      }
    }

    // Update dashboard display elements
    function updateDashboardDisplay() {
      // Main stats
      document.getElementById('avgWPM').textContent = performanceStats.avgWPM || '--';
      document.getElementById('bestWPM').textContent = performanceStats.bestWPM || '--';
      document.getElementById('testsCompleted').textContent = performanceStats.totalTests;
      document.getElementById('avgAccuracy').textContent = performanceStats.avgAccuracy ? performanceStats.avgAccuracy + '%' : '--';
      
      // Progress indicators
      document.getElementById('consistencyScore').textContent = performanceStats.consistency ? performanceStats.consistency + '%' : '--';
      document.getElementById('speedProgress').textContent = performanceStats.speedProgress ? performanceStats.speedProgress + '%' : '--';
      
      // Progress bars
      document.getElementById('consistencyBar').style.width = performanceStats.consistency + '%';
      document.getElementById('speedBar').style.width = performanceStats.speedProgress + '%';
    }

    // Reset performance statistics
    function resetPerformanceStats() {
      performanceStats = {
        tests: [],
        totalTests: 0,
        bestWPM: 0,
        avgWPM: 0,
        avgAccuracy: 0,
        consistency: 0,
        speedProgress: 0
      };
      savePerformanceStats();
      updateDashboardDisplay();
      showToast('Performance statistics reset!', 'success');
    }

    // Export performance data
    function exportPerformanceData() {
      if (performanceStats.tests.length === 0) {
        showToast('No data to export!', 'error');
        return;
      }
      
      const data = {
        summary: {
          totalTests: performanceStats.totalTests,
          bestWPM: performanceStats.bestWPM,
          avgWPM: performanceStats.avgWPM,
          avgAccuracy: performanceStats.avgAccuracy,
          consistency: performanceStats.consistency,
          speedProgress: performanceStats.speedProgress
        },
        testHistory: performanceStats.tests.map(test => ({
          wpm: test.wpm,
          accuracy: test.accuracy,
          date: new Date(test.date).toLocaleDateString(),
          time: new Date(test.date).toLocaleTimeString()
        }))
      };
      
      const jsonString = JSON.stringify(data, null, 2);
      const blob = new Blob([jsonString], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = `typing-performance-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showToast('Performance data exported!', 'success');
    }

    // Performance dashboard event listeners
    document.getElementById('resetStatsBtn')?.addEventListener('click', resetPerformanceStats);
    document.getElementById('exportStatsBtn')?.addEventListener('click', exportPerformanceData);

    // Initialize performance dashboard
    loadPerformanceStats();

    // Handle typing input
    function handleTypingInput() {
      if (!typingTestState.isActive || typingTestState.isPaused) return;

      const inputText = typingInput.value;
      const targetText = typingTestState.currentText;
      
      // Prevent typing beyond the text length
      if (inputText.length > targetText.length) {
        typingInput.value = inputText.substring(0, targetText.length);
        return;
      }

      typingTestState.typedText = inputText;
      typingTestState.correctChars = 0;
      let newMistakes = 0;

      // Count correct characters and mistakes
      for (let i = 0; i < inputText.length; i++) {
        if (inputText[i] === targetText[i]) {
          typingTestState.correctChars++;
        } else {
          newMistakes++;
        }
      }

      typingTestState.mistakes = newMistakes;
      
      displayText();
      updateMetrics();

      // Check if test is complete
      if (inputText.length === targetText.length) {
        endTypingTest();
      }
    }

    // Event listeners
    if (typingInfoBtn) {
      typingInfoBtn.addEventListener('click', () => {
        typingInfoModal.classList.remove('hidden');
      });
    }

    if (closeTypingInfo) {
      closeTypingInfo.addEventListener('click', () => {
        typingInfoModal.classList.add('hidden');
      });
    }

    if (typingInfoModal) {
      typingInfoModal.addEventListener('click', (e) => {
        if (e.target === typingInfoModal) {
          typingInfoModal.classList.add('hidden');
        }
      });
    }

    if (testDuration) {
      testDuration.addEventListener('change', () => {
        if (!typingTestState.isActive) {
          typingTestState.timeLeft = parseInt(testDuration.value);
          timeDisplay.textContent = typingTestState.timeLeft;
        }
      });
    }

    if (startTest) {
      startTest.addEventListener('click', startTypingTest);
    }

    if (pauseTest) {
      pauseTest.addEventListener('click', pauseTypingTest);
    }

    if (restartTest) {
      restartTest.addEventListener('click', restartTypingTest);
    }

    if (newTest) {
      newTest.addEventListener('click', () => {
        resetTypingTest();
        loadRandomText();
        showToast('New test ready! Click Start to begin.', 'success');
      });
    }

    if (typingInput) {
      typingInput.addEventListener('input', handleTypingInput);
      
      // Prevent common shortcuts that could interfere
      typingInput.addEventListener('keydown', (e) => {
        if (e.ctrlKey && (e.key === 'a' || e.key === 'c' || e.key === 'v')) {
          e.preventDefault();
          showToast('Copy/paste not allowed during test', 'error');
        }
      });
    }

    // Initialize typing test
    setTimeout(() => {
      initTypingTest();
    }, 500);

    // ===== API TESTER FUNCTIONALITY =====
    const apiTesterElements = {
      httpMethod: document.getElementById('httpMethod'),
      apiUrl: document.getElementById('apiUrl'),
      authType: document.getElementById('authType'),
      authFields: document.getElementById('authFields'),
      authValue: document.getElementById('authValue'),
      authKey: document.getElementById('authKey'),
      headersContainer: document.getElementById('headersContainer'),
      paramsContainer: document.getElementById('paramsContainer'),
      bodySection: document.getElementById('bodySection'),
      requestBody: document.getElementById('requestBody'),
      sendRequestBtn: document.getElementById('sendRequestBtn'),
      cancelRequestBtn: document.getElementById('cancelRequestBtn'),
      curlPreview: document.getElementById('curlPreview'),
      responseStatus: document.getElementById('responseStatus'),
      responseTabs: document.getElementById('responseTabs'),
      responseBody: document.getElementById('responseBody'),
      responseHeaders: document.getElementById('responseHeaders'),
      responseRaw: document.getElementById('responseRaw'),
      loadingState: document.getElementById('loadingState'),
      errorState: document.getElementById('errorState'),
      errorMessage: document.getElementById('errorMessage'),
      requestHistory: document.getElementById('requestHistory'),
      statusCode: document.getElementById('statusCode'),
      statusText: document.getElementById('statusText'),
      responseTime: document.getElementById('responseTime'),
      responseSize: document.getElementById('responseSize')
    };

    let currentRequest = null;
    let requestHistory = [];

    // Initialize API Tester
    function initApiTester() {
      if (!apiTesterElements.httpMethod) return;

      // Set up event listeners
      apiTesterElements.httpMethod.addEventListener('change', updateBodyVisibility);
      apiTesterElements.authType.addEventListener('change', updateAuthFields);
      apiTesterElements.sendRequestBtn.addEventListener('click', sendRequest);
      apiTesterElements.cancelRequestBtn.addEventListener('click', cancelRequest);
      
      // Dynamic input updates
      ['httpMethod', 'apiUrl'].forEach(id => {
        const element = apiTesterElements[id];
        if (element) {
          element.addEventListener('input', updateCurlPreview);
          element.addEventListener('change', updateCurlPreview);
        }
      });

      // Add header/param buttons
      document.getElementById('addHeaderBtn')?.addEventListener('click', addHeaderRow);
      document.getElementById('addParamBtn')?.addEventListener('click', addParamRow);
      
      // Response tabs
      document.querySelectorAll('.response-tab').forEach(tab => {
        tab.addEventListener('click', switchResponseTab);
      });

      // JSON formatting buttons
      document.getElementById('formatJsonBtn')?.addEventListener('click', formatJson);
      document.getElementById('validateJsonBtn')?.addEventListener('click', validateJson);
      
      // Copy buttons
      document.getElementById('copyCurlBtn')?.addEventListener('click', copyCurl);
      document.getElementById('copyResponseBtn')?.addEventListener('click', copyResponse);
      
      // Clear history
      document.getElementById('clearHistoryBtn')?.addEventListener('click', clearHistory);

      // Initial setup
      updateBodyVisibility();
      updateCurlPreview();
    }

    function updateBodyVisibility() {
      const method = apiTesterElements.httpMethod?.value;
      const showBody = ['POST', 'PUT', 'PATCH'].includes(method);
      
      if (apiTesterElements.bodySection) {
        apiTesterElements.bodySection.classList.toggle('hidden', !showBody);
      }
      updateCurlPreview();
    }

    function updateAuthFields() {
      const authType = apiTesterElements.authType?.value;
      const authFields = apiTesterElements.authFields;
      const authKey = apiTesterElements.authKey;
      
      if (!authFields) return;

      if (authType === 'none') {
        authFields.classList.add('hidden');
      } else {
        authFields.classList.remove('hidden');
        if (authType === 'apikey') {
          authKey?.classList.remove('hidden');
          apiTesterElements.authValue?.setAttribute('placeholder', 'API Key value');
          authKey?.setAttribute('placeholder', 'Header name (e.g., X-API-Key)');
        } else {
          authKey?.classList.add('hidden');
          if (authType === 'bearer') {
            apiTesterElements.authValue?.setAttribute('placeholder', 'Bearer token');
          } else if (authType === 'basic') {
            apiTesterElements.authValue?.setAttribute('placeholder', 'username:password');
          }
        }
      }
      updateCurlPreview();
    }

    function addHeaderRow() {
      const container = apiTesterElements.headersContainer;
      if (!container) return;

      const row = document.createElement('div');
      row.className = 'flex gap-2';
      row.innerHTML = `
        <input type="text" placeholder="Header name" class="flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 header-key">
        <input type="text" placeholder="Header value" class="flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 header-value">
        <button class="px-2 py-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors remove-header">
          <i class="fa-solid fa-trash text-sm"></i>
        </button>
      `;
      
      row.querySelector('.remove-header').addEventListener('click', () => row.remove());
      container.appendChild(row);
      updateCurlPreview();
    }

    function addParamRow() {
      const container = apiTesterElements.paramsContainer;
      if (!container) return;

      const row = document.createElement('div');
      row.className = 'flex gap-2';
      row.innerHTML = `
        <input type="text" placeholder="Parameter name" class="flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 param-key">
        <input type="text" placeholder="Parameter value" class="flex-1 px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 param-value">
        <button class="px-2 py-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors remove-param">
          <i class="fa-solid fa-trash text-sm"></i>
        </button>
      `;
      
      row.querySelector('.remove-param').addEventListener('click', () => row.remove());
      container.appendChild(row);
      updateCurlPreview();
    }

    function updateCurlPreview() {
      if (!apiTesterElements.curlPreview) return;

      const method = apiTesterElements.httpMethod?.value || 'GET';
      const url = apiTesterElements.apiUrl?.value || 'https://api.example.com/users';
      
      let curl = `curl -X ${method}`;
      
      // Add headers
      const headers = getHeaders();
      headers.forEach(header => {
        if (header.key && header.value) {
          curl += ` -H "${header.key}: ${header.value}"`;
        }
      });
      
      // Add body for POST/PUT/PATCH
      if (['POST', 'PUT', 'PATCH'].includes(method)) {
        const body = apiTesterElements.requestBody?.value;
        if (body) {
          curl += ` -d '${body}'`;
        }
      }
      
      curl += ` "${url}"`;
      
      // Add query parameters
      const params = getParams();
      if (params.length > 0) {
        const queryString = params.map(p => `${encodeURIComponent(p.key)}=${encodeURIComponent(p.value)}`).join('&');
        curl = curl.replace(`"${url}"`, `"${url}${url.includes('?') ? '&' : '?'}${queryString}"`);
      }
      
      apiTesterElements.curlPreview.textContent = curl;
    }

    function getHeaders() {
      const headers = [];
      const headerRows = apiTesterElements.headersContainer?.querySelectorAll('.header-key');
      
      headerRows?.forEach((keyInput, index) => {
        const valueInput = apiTesterElements.headersContainer.querySelectorAll('.header-value')[index];
        if (keyInput.value && valueInput.value) {
          headers.push({ key: keyInput.value, value: valueInput.value });
        }
      });
      
      // Add auth header
      const authType = apiTesterElements.authType?.value;
      const authValue = apiTesterElements.authValue?.value;
      
      if (authType === 'bearer' && authValue) {
        headers.push({ key: 'Authorization', value: `Bearer ${authValue}` });
      } else if (authType === 'basic' && authValue) {
        headers.push({ key: 'Authorization', value: `Basic ${btoa(authValue)}` });
      } else if (authType === 'apikey' && authValue) {
        const authKey = apiTesterElements.authKey?.value || 'X-API-Key';
        headers.push({ key: authKey, value: authValue });
      }
      
      return headers;
    }

    function getParams() {
      const params = [];
      const paramRows = apiTesterElements.paramsContainer?.querySelectorAll('.param-key');
      
      paramRows?.forEach((keyInput, index) => {
        const valueInput = apiTesterElements.paramsContainer.querySelectorAll('.param-value')[index];
        if (keyInput.value && valueInput.value) {
          params.push({ key: keyInput.value, value: valueInput.value });
        }
      });
      
      return params;
    }

    async function sendRequest() {
      const method = apiTesterElements.httpMethod?.value || 'GET';
      const url = apiTesterElements.apiUrl?.value;
      
      if (!url) {
        showError('Please enter a URL');
        return;
      }
      
      // Show loading state
      showLoading();
      apiTesterElements.sendRequestBtn?.classList.add('hidden');
      apiTesterElements.cancelRequestBtn?.classList.remove('hidden');
      
      const startTime = Date.now();
      
      try {
        // Build request options
        const options = {
          method: method,
          headers: {}
        };
        
        // Add headers
        const headers = getHeaders();
        headers.forEach(header => {
          options.headers[header.key] = header.value;
        });
        
        // Add body for POST/PUT/PATCH
        if (['POST', 'PUT', 'PATCH'].includes(method)) {
          const body = apiTesterElements.requestBody?.value;
          if (body) {
            options.body = body;
            if (!options.headers['Content-Type']) {
              options.headers['Content-Type'] = 'application/json';
            }
          }
        }
        
        // Build URL with query parameters
        let requestUrl = url;
        const params = getParams();
        if (params.length > 0) {
          const queryString = params.map(p => `${encodeURIComponent(p.key)}=${encodeURIComponent(p.value)}`).join('&');
          requestUrl += (url.includes('?') ? '&' : '?') + queryString;
        }
        
        // Make request with timeout
        const controller = new AbortController();
        currentRequest = controller;
        
        const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout
        
        const response = await fetch(requestUrl, {
          ...options,
          signal: controller.signal
        });
        
        clearTimeout(timeoutId);
        const endTime = Date.now();
        const responseTime = endTime - startTime;
        
        // Get response data
        const responseText = await response.text();
        let responseData;
        let contentType = response.headers.get('content-type') || '';
        
        try {
          responseData = JSON.parse(responseText);
        } catch {
          responseData = responseText;
        }
        
        // Show response
        showResponse({
          status: response.status,
          statusText: response.statusText,
          headers: Object.fromEntries(response.headers.entries()),
          data: responseData,
          responseTime: responseTime,
          size: new Blob([responseText]).size
        });
        
        // Add to history
        addToHistory({
          method,
          url: requestUrl,
          status: response.status,
          time: responseTime
        });
        
      } catch (error) {
        if (error.name === 'AbortError') {
          showError('Request was cancelled');
        } else if (error.name === 'TypeError' && error.message.includes('fetch')) {
          showError('Network error - check CORS settings or use a proxy');
        } else {
          showError(`Request failed: ${error.message}`);
        }
      } finally {
        // Reset UI
        apiTesterElements.sendRequestBtn?.classList.remove('hidden');
        apiTesterElements.cancelRequestBtn?.classList.add('hidden');
        currentRequest = null;
      }
    }

    function cancelRequest() {
      if (currentRequest) {
        currentRequest.abort();
        currentRequest = null;
      }
    }

    function showLoading() {
      apiTesterElements.loadingState?.classList.remove('hidden');
      apiTesterElements.responseStatus?.classList.add('hidden');
      apiTesterElements.responseTabs?.classList.add('hidden');
      apiTesterElements.errorState?.classList.add('hidden');
      
      if (apiTesterElements.loadingState) {
        apiTesterElements.loadingState.innerHTML = `
          <div class="text-center">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-2"></div>
            <p class="text-sm">Sending request...</p>
          </div>
        `;
      }
    }

    function showResponse(response) {
      // Hide loading and error states
      apiTesterElements.loadingState?.classList.add('hidden');
      apiTesterElements.errorState?.classList.add('hidden');
      
      // Show response status
      if (apiTesterElements.responseStatus) {
        apiTesterElements.responseStatus.classList.remove('hidden');
        
        // Update status code styling
        const statusCode = apiTesterElements.statusCode;
        if (statusCode) {
          statusCode.textContent = response.status;
          statusCode.className = 'px-1 py-0.5 rounded text-xs font-medium';
          
          if (response.status >= 200 && response.status < 300) {
            statusCode.classList.add('bg-green-100', 'text-green-800');
          } else if (response.status >= 400) {
            statusCode.classList.add('bg-red-100', 'text-red-800');
          } else {
            statusCode.classList.add('bg-yellow-100', 'text-yellow-800');
          }
        }
        
        if (apiTesterElements.statusText) {
          apiTesterElements.statusText.textContent = response.statusText;
        }
        if (apiTesterElements.responseTime) {
          apiTesterElements.responseTime.textContent = `${response.responseTime}ms`;
        }
        if (apiTesterElements.responseSize) {
          apiTesterElements.responseSize.textContent = formatBytes(response.size);
        }
      }
      
      // Show response tabs
      apiTesterElements.responseTabs?.classList.remove('hidden');
      
      // Update response body
      if (apiTesterElements.responseBody) {
        if (typeof response.data === 'object') {
          apiTesterElements.responseBody.textContent = JSON.stringify(response.data, null, 2);
        } else {
          apiTesterElements.responseBody.textContent = response.data;
        }
      }
      
      // Update response headers
      if (apiTesterElements.responseHeaders) {
        apiTesterElements.responseHeaders.textContent = JSON.stringify(response.headers, null, 2);
      }
      
      // Update raw response
      if (apiTesterElements.responseRaw) {
        const rawResponse = `HTTP/1.1 ${response.status} ${response.statusText}\n${Object.entries(response.headers).map(([k, v]) => `${k}: ${v}`).join('\n')}\n\n${typeof response.data === 'object' ? JSON.stringify(response.data, null, 2) : response.data}`;
        apiTesterElements.responseRaw.textContent = rawResponse;
      }
    }

    function showError(message) {
      apiTesterElements.loadingState?.classList.add('hidden');
      apiTesterElements.responseStatus?.classList.add('hidden');
      apiTesterElements.responseTabs?.classList.add('hidden');
      apiTesterElements.errorState?.classList.remove('hidden');
      
      if (apiTesterElements.errorMessage) {
        apiTesterElements.errorMessage.textContent = message;
      }
    }

    function switchResponseTab(event) {
      const tabName = event.target.dataset.tab;
      if (!tabName) return;
      
      // Update tab styling
      document.querySelectorAll('.response-tab').forEach(tab => {
        tab.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
        tab.classList.add('text-gray-500');
      });
      
      event.target.classList.remove('text-gray-500');
      event.target.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
      
      // Show corresponding content
      document.querySelectorAll('.response-content').forEach(content => {
        content.classList.add('hidden');
      });
      
      document.getElementById(`response${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`)?.classList.remove('hidden');
    }

    function formatJson() {
      const body = apiTesterElements.requestBody?.value;
      if (!body) return;
      
      try {
        const parsed = JSON.parse(body);
        apiTesterElements.requestBody.value = JSON.stringify(parsed, null, 2);
        showToast('JSON formatted successfully', 'success');
      } catch (error) {
        showToast('Invalid JSON format', 'error');
      }
    }

    function validateJson() {
      const body = apiTesterElements.requestBody?.value;
      if (!body) {
        showToast('No JSON to validate', 'info');
        return;
      }
      
      try {
        JSON.parse(body);
        showToast('Valid JSON ✓', 'success');
      } catch (error) {
        showToast(`Invalid JSON: ${error.message}`, 'error');
      }
    }

    function copyCurl() {
      const curl = apiTesterElements.curlPreview?.textContent;
      if (curl) {
        navigator.clipboard.writeText(curl).then(() => {
          showToast('cURL command copied to clipboard', 'success');
        });
      }
    }

    function copyResponse() {
      const response = apiTesterElements.responseBody?.textContent;
      if (response) {
        navigator.clipboard.writeText(response).then(() => {
          showToast('Response copied to clipboard', 'success');
        });
      }
    }

    function addToHistory(request) {
      requestHistory.unshift({
        ...request,
        timestamp: new Date().toLocaleTimeString()
      });
      
      // Keep only last 10 requests
      if (requestHistory.length > 10) {
        requestHistory = requestHistory.slice(0, 10);
      }
      
      updateHistoryDisplay();
    }

    function updateHistoryDisplay() {
      const container = apiTesterElements.requestHistory;
      if (!container) return;
      
      if (requestHistory.length === 0) {
        container.innerHTML = '<div class="text-xs text-gray-500 text-center py-2">No requests yet</div>';
        return;
      }
      
      container.innerHTML = requestHistory.map(req => `
        <div class="flex items-center justify-between p-2 bg-gray-50 rounded text-xs hover:bg-gray-100 cursor-pointer">
          <div class="flex items-center gap-2">
            <span class="px-1 py-0.5 bg-blue-100 text-blue-800 rounded font-mono">${req.method}</span>
            <span class="text-gray-600 truncate max-w-32">${req.url}</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="px-1 py-0.5 ${req.status >= 400 ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'} rounded">${req.status}</span>
            <span class="text-gray-500">${req.time}ms</span>
          </div>
        </div>
      `).join('');
    }

    function clearHistory() {
      requestHistory = [];
      updateHistoryDisplay();
      showToast('Request history cleared', 'success');
    }

    function formatBytes(bytes) {
      if (bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
    }

    // API Tester Info Modal
    const apiInfoBtn = document.getElementById('apiInfoBtn');
    const apiInfoModal = document.getElementById('apiInfoModal');
    const closeApiInfo = document.getElementById('closeApiInfo');

    if (apiInfoBtn) {
      apiInfoBtn.addEventListener('click', () => apiInfoModal.classList.remove('hidden'));
    }
    
    if (closeApiInfo) {
      closeApiInfo.addEventListener('click', () => apiInfoModal.classList.add('hidden'));
    }

    if (apiInfoModal) {
      apiInfoModal.addEventListener('click', (e) => {
        if (e.target === apiInfoModal) {
          apiInfoModal.classList.add('hidden');
        }
      });
    }

    // Initialize API Tester
    setTimeout(() => {
      initApiTester();
    }, 500);

    // Simple navbar scroll effect without auto-scroll
    document.addEventListener('DOMContentLoaded', () => {
      // Remove any hash from URL without scrolling
      if (window.location.hash) {
        history.replaceState(null, null, window.location.pathname + window.location.search);
      }
      
      // Ensure page always starts at the top and prevent any auto-scrolling
      window.scrollTo(0, 0);
      
      // Prevent any delayed scrolling
      setTimeout(() => {
        window.scrollTo(0, 0);
      }, 100);
      
      setTimeout(() => {
        window.scrollTo(0, 0);
      }, 500);
      
      setTimeout(() => {
        window.scrollTo(0, 0);
      }, 1000);
      
      // Override any scroll attempts
      let scrollAttempts = 0;
      const originalScrollTo = window.scrollTo;
      window.scrollTo = function(x, y) {
        if (scrollAttempts < 5 && y > 0) {
          scrollAttempts++;
          return originalScrollTo.call(this, 0, 0);
        }
        return originalScrollTo.call(this, x, y);
      };
      
      // Reset scroll override after 3 seconds
      setTimeout(() => {
        window.scrollTo = originalScrollTo;
      }, 3000);

      // Mobile menu functionality
      const hamburger = document.getElementById('hamburger');
      const mobileMenu = document.getElementById('mobile-menu');
      const hamburgerLines = hamburger.children;
      const navbar = document.querySelector('.glassmorphism-navbar');

      hamburger.addEventListener('click', () => {
        mobileMenu.classList.toggle('-translate-x-full');
        hamburgerLines[0].classList.toggle('rotate-45');
        hamburgerLines[0].classList.toggle('translate-y-2');
        hamburgerLines[1].classList.toggle('opacity-0');
        hamburgerLines[2].classList.toggle('-rotate-45');
        hamburgerLines[2].classList.toggle('-translate-y-2');
      });

      // Glassmorphism scroll effect
      function updateNavbar() {
        const currentScrollY = window.scrollY;
        
        if (currentScrollY > 50) {
          navbar.classList.add('scrolled');
        } else {
          navbar.classList.remove('scrolled');
        }
      }

      updateNavbar();
      window.addEventListener('scroll', updateNavbar, { passive: true });
    });

  </script>

  <!-- Footer Border -->
  <div class="w-full h-px bg-gradient-to-r from-transparent via-pink-400 to-transparent relative">
    <div class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 w-3 h-3 bg-pink-400 rotate-45"></div>
  </div>
  
  <!-- Footer -->
  <footer class="relative overflow-hidden bg-orange-50">
    
    <div class="relative mx-auto max-w-6xl px-6 py-8">
      <!-- Main Footer Content -->
      <div class="flex flex-col md:flex-row justify-between items-center gap-8">
        
        <!-- Brand Section -->
        <div class="flex items-center gap-3">
          <img src="assets/logo-sparkle.svg" alt="Logo" class="w-10 h-10">
          <div>
            <h3 class="font-bold text-lg text-gray-900">Sumaiyah</h3>
            <p class="text-xs text-gray-500">Aspiring AI · ML · Data Science Engineer</p>
          </div>
        </div>
        
        <!-- Quick Links -->
        <nav class="flex flex-wrap justify-center items-center gap-4">
          <a href="index.html" class="text-gray-600 hover:text-pink-500 transition-colors text-sm">Home</a>
          <span class="text-pink-400 text-xs">✦</span>
          <a href="about.html" class="text-gray-600 hover:text-pink-500 transition-colors text-sm">About</a>
          <span class="text-pink-400 text-xs">✦</span>
          <a href="project.html" class="text-gray-600 hover:text-pink-500 transition-colors text-sm">Projects</a>
          <span class="text-pink-400 text-xs">✦</span>
          <a href="playground.html" class="text-gray-600 hover:text-pink-500 transition-colors text-sm">Playground</a>
          <span class="text-pink-400 text-xs">✦</span>
          <a href="connect.html" class="text-gray-600 hover:text-pink-500 transition-colors text-sm">Connect</a>
        </nav>
        
        <!-- Social Links -->
        <div class="flex items-center gap-4">
          <a href="https://github.com/sumaiyahibrahim" target="_blank" rel="noopener noreferrer" 
             class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-pink-100 transition-colors group">
            <i class="fab fa-github text-sm text-gray-600 group-hover:text-pink-500"></i>
          </a>
          <a href="https://www.linkedin.com/in/sumaiyah-ibrahim-27049a284" target="_blank" rel="noopener noreferrer"
             class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-pink-100 transition-colors group">
            <i class="fab fa-linkedin text-sm text-gray-600 group-hover:text-pink-500"></i>
          </a>
          <a href="mailto:sumaiyahibrahim15@gmail.com"
             class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-pink-100 transition-colors group">
            <i class="fas fa-envelope text-sm text-gray-600 group-hover:text-pink-500"></i>
          </a>
        </div>
      </div>
      
    </div>
  </footer>

</body>
</html>
